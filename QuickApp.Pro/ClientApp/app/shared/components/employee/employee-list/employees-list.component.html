﻿<div class="card">
     <div class="card-body">
         <div class="inline-block display-flex">
             <h3 class="po-head lead">Employee List</h3>
             &nbsp;&nbsp;&nbsp;&nbsp;
             <a matTooltip="Add Employee" matTooltipPosition="above" (click)="navigateTogeneralInfo()" class="plusicon-cstm new-margin"><span><i class="fa fa-plus-circle fa-lg"></i></span></a>
         </div>

         <p-table #dt class="ptable-custom" [value]="allVendorList" [rows]="10" [paginator]="true" (onLazyLoad)="loadCustomerPages($event)" [pageLinks]="3" [rowsPerPageOptions]="[10,20,50,100]" [columns]="selectedColumns" [metaKeySelection]="true" selectionMode="multiple" [(selection)]="selectedColumn" [resizableColumns]="true" [scrollable]="true" [reorderableColumns]="true" scrollHeight="450px">
             <ng-template pTemplate="caption" style="min-height: 40px;">

                 <div style="text-align: right; min-height: 30px;">
                     <p-multiSelect [options]="cols" [(ngModel)]="selectedColumns" optionLabel="header"
                                    selectedItemsLabel="{0} columns selected" [style]="{minWidth: '200px'}" defaultLabel="Choose Columns" style="float:left"></p-multiSelect>

                     <div class="inner-addon right-addon w200 inline-block g-filter-search-cstm">
                         <i class="fa fa-search"></i>
                         <input type="text" pInputText size="50" class="form-control ui-autocomplete-input" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder=" Filter">
                     </div>

                     <button type="button" pButton icon="fa-download " class="btn-primary-cstm" iconPos="left"
                     (click)="dt.exportCSV()" label="Export Data" matTooltip="Download Data" matTooltipPosition="above" style="padding: 5px 12px !important;"></button>
                     <button type="button" pButton icon="fa-download " class="btn-primary-cstm" iconPos="left" label="Export Selected Data" matTooltip="Download Selected Data" matTooltipPosition="above" (click)="dt.exportCSV({selectionOnly:true})"  style="padding: 5px 12px !important;"></button>

                 </div>
             </ng-template>

             <ng-template pTemplate="colgroup" let-columns>
                    <colgroup>
                        <col *ngFor="let col of columns">
                    </colgroup>
                </ng-template>

             <ng-template pTemplate="header" let-columns>
                 <tr>

                     <th *ngFor="let col of columns" pResizableColumn pReorderableColumn [pSortableColumn]="col.field">
                         {{col.header}}
                         <p-sortIcon [field]="col.field"></p-sortIcon>
                     </th>

                     <th style="width: 130px;"></th>

                 </tr>

                 <tr>
                     <th *ngFor="let col of columns" [ngSwitch]="col.field">
                         <input style="width:100%;" pInputText type="text" (input)="dt.filter($event.target.value, col.field, 'contains')">
                     </th>
                     <th style="width: 130px;"></th>
                 </tr>
             </ng-template>

             <ng-template pTemplate="body" let-rowData let-columns="columns">
                 <tr [pSelectableRow]="rowData" pReorderableRowHandle (dblclick)="openEdit(rowData)">
                     <td *ngFor="let col of columns" class="ui-resizable-column" pReorderableRowHandle>
                         {{col.field == 'startDate'?  (rowData[col.field] | date: 'MM/dd/yyyy'):rowData[col.field] && col.field == 'updatedDate'?  (rowData[col.field] | date: 'MM/dd/yyyy'):getData(rowData, col.field)}}
                     </td>

                     <td style="width: 130px;">
                         <p-inputSwitch *ngIf="rowData['isActive']==true" matTooltip="Active" onLabel="on" offLabel="off" (onChange)="handleChange(rowData,$event)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                         <p-inputSwitch *ngIf="rowData['isActive']==false" matTooltip="In Active" onLabel="on" offLabel="off" (onChange)="handleChange(rowData,$event)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                         <p-inputSwitch *ngIf="rowData['isActive']==null" matTooltip="In Active" onLabel="on" offLabel="off" (onChange)="handleChange(rowData,$event)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                         <span data-toggle="modal" data-target="#view"> <a class="btn btn-info boxed-float-btn nobg" data-toggle="tooltip" (click)="openView(view,rowData)" matTooltip="View"><i class="fa fa-eye"></i></a> </span>
                         <button class="btn-edit" mat-icon-button (click)="openEdit(rowData)" matTooltip="Edit">
                             <mat-icon>edit</mat-icon>
                         </button>
                         <button class="btn-delete" mat-icon-button matTooltip="Delete" (click)="openDelete(content,rowData)">

                             <mat-icon color="warn">delete</mat-icon>
                         </button>


                         <button class="btn-history" mat-icon-button matTooltip="History" data-target="#employeeHistory" data-toggle="modal" (click)="getAuditHistoryById(rowData)">
                             <mat-icon color="green">history</mat-icon>
                         </button>

                     </td>
                 </tr>
             </ng-template>




             <ng-template pTemplate="summary" id="footer">
                 <label id="footer" class="footer">No'of records:</label>
                 <input style="width: 5%;" [(ngModel)]="totalRecords" [disabled]="true" pInputText type="text" /> &nbsp;&nbsp;
                 <label id="footer" class="footer1">Pages Count:</label>
                 <input style="width: 5%;" [(ngModel)]="totalPages" [disabled]="true" pInputText type="text" />
             </ng-template>

         </p-table>

         <ng-template #content let-c="close" let-d="dismiss" data-backdrop="static">
             <div class="modal-header">
                 <h4 class="modal-title">Are You Sure Want to Delete?</h4>
                 <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
                     <span aria-hidden="true">&times;</span>
                 </button>
             </div>

             <div class="modal-footer">
                 <button type="button" class="btn btn-primary-cstm" (click)="deleteItemAndCloseModel()">Yes</button>
                 <button type="button" class="btn btn-danger-cstm" (click)="dismissModel()">No</button>
             </div>
         </ng-template>
         
     </div>
</div>

<div id="view" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg">
      
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
                    <button type="button" class="close"  data-dismiss="modal" >×</button>
                    <h4 class="modal-title">Employer Details</h4>
            </div>
            <div class="modal-body modal-body-cstm">
                    <div class="table-responsive default-bg clear">
                    
                    
                            <!--<a href="#" class="btn btn-primary openall">open all</a> <a href="#" class="btn btn-warning closeall">close all</a>-->
                            <div class="panel-group" id="accordion">
                                <div class="panel panel-default">
                                    <div>
                                        <button type="button" class="btn btn-primary-cstm" data-toggle="collapse" (click)="ExpandAllEmployeeDetailsModel()" >Expand All</button>
                                        <button type="button" class="btn btn-primary-cstm collapsed" data-toggle="collapse" (click)="CloseAllEmployeerDetailsModel()" >Collapse All</button>
                                        <hr />
                                    </div>
                                    <div class="panel-heading">
                                        <h4 class="panel-title"> <a class="collapsed" data-toggle="collapse" href="#step1" >General Information</a> </h4>
                                    </div>
                                    <div id="step1" class="panel-collapse  collapse" *ngIf="allEmployeelist">
                                        <div class="panel-body">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div>
                                                    <div class="table-responsive default-bg clear">
                                                        <div class="col-sm-4">
                                                            <p><span class="label"><b>First Name: </b></span><span class="value">{{allEmployeelist.firstName ? allEmployeelist.firstName : '-'}}</span></p>
                                                            <p><span class="label"><b>Last Name: </b></span><span class="value">{{allEmployeelist.lastName ? allEmployeelist.lastName : '-'}}</span></p>
                                                            <p><span class="label"><b>Employee Id: </b></span><span class="value">{{allEmployeelist.employeeId ? allEmployeelist.employeeId : '-'}}</span></p>
                                                            <p><span class="label"><b>Employee Id (per Payroll): </b></span><span class="value">{{allEmployeelist.employeeIdAsPerPayroll ? allEmployeelist.employeeIdAsPerPayroll : '-'}}</span></p>
                                                            <p><span class="label"><b>Legal Entity: </b></span><span class="value">{{compnayname ? compnayname : '-'}}</span></p>    
                                                            <p><span class="label"><b>BU: </b></span><span class="value">{{biuName ? biuName : '-'}}</span></p>
                                                            <p><span class="label"><b>Division: </b></span><span class="value">{{divsioname ? divsioname : '-'}}</span></p>   
                                                            <p><span class="label"><b>Dept: </b></span><span class="value">{{departname ? departname : '-'}}</span></p>    
                                                            <p><span class="label"><b>Job Title: </b></span><span class="value">{{jobTitleName ? jobTitleName : '-'}}</span></p>    
                                                            <p><span class="label"><b>Job Type: </b></span><span class="value">{{jobTypeName ? jobTypeName : '-'}}</span></p>                                                                                       
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <p><span class="label"><b>Employee Expertise: </b></span><span class="value">{{empExpertisedescription ? empExpertisedescription : '-'}}</span></p>
                                                            <p><span class="label"><b>Station ID: </b></span><span class="value">{{allEmployeelist.stationId ? allEmployeelist.stationId : '-'}}</span></p>
                                                            <p><span class="label"><b>Date of Birth: </b></span><span class="value">{{allEmployeelist.dateOfBirth | date:'MM-dd-yyyy'}}</span></p>
                                                            <p><span class="label"><b>Country of Origin: </b></span><span class="value">{{originationCounty ? originationCounty : '-'}}</span></p>
                                                            <p><span class="label"><b>Start Date: </b></span><span class="value">{{allEmployeelist.startDate | date: 'dd/MM/yyyy'}}</span></p>
                                                            <p><span class="label"><b>Cell: </b></span><span class="value">{{allEmployeelist.mobilePhone ? allEmployeelist.mobilePhone : '-'}}</span></p>
                                                            <p><span class="label"><b>Business Phone: </b></span><span class="value">{{allEmployeelist.workPhone ? allEmployeelist.workPhone : '-'}}</span></p>
                                                            <p><span class="label"><b>Fax: </b></span><span class="value">{{allEmployeelist.fax ? allEmployeelist.fax : '-'}}</span></p>
                                                            <p><span class="label"><b>Email: </b></span><span class="value">{{allEmployeelist.email ? allEmployeelist.email : '-'}}</span></p>
                                                            <p><span class="label"><b>SS: </b></span><span class="value">{{allEmployeelist.ssn ? allEmployeelist.ssn : '-'}}</span></p>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <p><span class="label"><b>Shift: </b></span>
                                                                <span class="value" *ngIf="allEmployeelist.inMultipleShifts == true">Multiple Shift</span>
                                                                <span class="value" *ngIf="allEmployeelist.inMultipleShifts == false">Single Shift</span>
                                                            </p>
                                                            <p><span class="label"><b>Shift Type: </b></span><span class="value">
                                                                <div *ngFor="let shift of shiftMapArray">
                                                                    <span class="value">{{shift.shiftId}}</span>
                                                                </div>
                                                            </span></p>
                                                            <p><span class="label"><b>Extra Hours: </b></span><span class="value">{{allEmployeelist.allowOvertime ? allEmployeelist.allowOvertime : '-'}}</span></p>
                                                            <p>
                                                                <span *ngIf="allEmployeelist.isHourly == true" class="label"><b>Hourly Pay: </b></span>
                                                                <span *ngIf="allEmployeelist.isHourly == false" class="label"><b>Monthly Pay: </b></span>
                                                                <span *ngIf="!allEmployeelist.isHourly" class="label"><b>Pay: </b></span>
                                                                <span class="value">{{allEmployeelist.hourlyPay ? allEmployeelist.hourlyPay : '-'}}</span>
                                                            </p>   
                                                            <p><span class="label"><b>Currency: </b></span><span class="value">{{currencyName}}</span></p>
                                                            <p><span class="label"><b>Leave: </b></span><span class="value">
                                                                <div *ngFor="let leave of leaveMapArray">
                                                                    <span class="value">{{leave.employeeLeaveTypeId}}</span>
                                                                </div>
                                                            </span></p>
                                                            <p><span class="label"><b>Employee Certifying Staff?: </b></span><span class="value">{{allEmployeelist.employeeCertifyingStaff ? allEmployeelist.employeeCertifyingStaff : '-'}}</span></p>
                                                        </div>
                                                    </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
        
                                        </div>
                                    </div>
        
                                     <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h4 class="panel-title"> <a class="collapsed" data-toggle="collapse" href="#step2">Certification</a> </h4>
                                        </div>
                                        <div id="step2" class="panel-collapse  collapse">
                                            <div class="panel-body">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div>
                                                        <div class="table-responsive default-bg clear" *ngIf="allEmployeelist.employeeLicensure">
                                                            <div class="col-sm-4">
                                                                <p><span class="label"><b>Certification #: </b></span><span class="value">{{allEmployeelist.employeeLicensure?.licenseNumber}}</span></p>
                                                                <p><span class="label"><b>Certification In Force? </b></span><span class="value">{{allEmployeelist.employeeLicensure?.isLicenseInForce}}</span></p>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <p><span class="label"><b>Certifying Institution: </b></span><span class="value">{{allEmployeelist.employeeLicensure?.certifyingInstitution}}</span></p>                                                                
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <p><span class="label"><b>Certification Date: </b></span><span class="value">{{allEmployeelist.employeeLicensure?.certificationDate | date:'MM-dd-yyyy'}}</span></p>
                                                            </div>                                                            
                                                        </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
        
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#step3">Training</a> </h4>
                                        </div>
                                        <div id="step3" class="panel-collapse  collapse">
                                            <div class="panel-body">
                                                <div class="card">
                                                    <div class="card-body">
                                                        <div>
                                                        <div class="table-responsive default-bg clear" *ngIf="allEmployeelist.employeeTraining">
                                                            <div class="col-sm-4">
                                                                <p><span class="label"><b>Aircraft Model: </b></span><span class="value">{{allEmployeelist.employeeTraining?.aircraftModelId}}</span></p>
                                                                <p><span class="label"><b>Training Type: </b></span><span class="value">{{empTrainningInfo}}</span></p> 
                                                                <p><span class="label"><b>Schedule Date: </b></span><span class="value">{{allEmployeelist.employeeTraining?.scheduleDate | date:'MM-dd-yyyy'}}</span></p> 
                                                                <p><span class="label"><b>Frequency of Training: </b></span><span class="value">{{frequencyOfTrainingData}}</span></p>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <p><span class="label"><b>Completion Date: </b></span><span class="value">{{allEmployeelist.employeeTraining?.completionDate | date:'MM-dd-yyyy'}}</span></p>                                                           
                                                                <p><span class="label"><b>Cost: </b></span><span class="value">{{allEmployeelist.employeeTraining?.cost}}</span></p>
                                                                <p><span class="label"><b>Duration: </b></span><span class="value">{{allEmployeelist.employeeTraining?.duration}}</span></p>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <p><span class="label"><b>Provider: </b></span><span class="value">{{allEmployeelist.employeeTraining?.provider}}</span></p>                                                           
                                                                <p><span class="label"><b>Industry Code: </b></span><span class="value">{{allEmployeelist.employeeTraining?.industryCode}}</span></p>
                                                                <p><span class="label"><b>Expiration Date: </b></span><span class="value">{{allEmployeelist.employeeTraining?.expirationDate | date:'MM-dd-yyyy'}}</span></p>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <div class="table-responsive table-overflow" *ngIf="allEmployeeTrainingDocumentsList.length> 0">
                                                                    <h4 class="panel-title">Attachment Details:</h4>
                                                                    <table class="table table-bordered ">
                                                                            <thead>                                                         <tr>
                                                                                            <th>File Name</th>
                                                                                            <th>Download</th>
                                                                                           
                                                                                    </tr>
                                                                            </thead>
                            
                                                                        <tbody *ngFor="let f of allEmployeeTrainingDocumentsList">
                                                                                <tr>                                                             
                                                                                    <td>{{f.fileName}}</td>
                                                                                    <td><a (click)="downloadFileUpload(f)" matTooltip="Download" class="btn nobg btn-cstm"><span><i class="fa fa-download"></i></span></a> </td>
                                                                                                                                                                   
                                                                                </tr>
                                                                            
                                                                        </tbody>
                            
                                                                    </table>
                                                                </div>

                                                            </div>
                                                        </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>     
                                </div>
                            </div>
                        </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger-cstm" data-dismiss="modal">Close</button>
            </div>
          </div>
      
        </div>
      </div>

      <div id="employeeHistory" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false" data-backdrop="static">
            <div class="modal-dialog modal-lg">
          
              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title">History of Employee</h4>
                </div>
                <div class="modal-body">
                    <div class="table-responsive rro-table-cstm">
                        <table class="table table-bordered" *ngIf="auditHistory.length> 0 else noDatavailable">
                            <thead>
                                <tr>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>EmpID</th>
                                    <th>Job Title</th>
                                    <th>Emp Expertise</th>
                                    <th>Job Type</th>
                                    <th>Start Date</th>
                                    <!-- <th>Company</th> -->
                                    <th>Pay Type</th>
                                    <th>IsActive</th>
                                    <th>Updated By</th>
                                    <th>Updated Time</th>
                                </tr>
                            </thead>
                            <tbody class="audithistory-cstm"> <!--*ngIf="auditHistory.length> 0"-->
                                <tr *ngFor="let audit of auditHistory; let i = index;">
                                    <!-- auditHistory[i>0 ? i-1 : i] -->          
                                        <td [ngStyle]="{'color':  getColorCodeForHistory(i, 'firstName', audit.firstName)  ? 'black' : 'red'  }">{{ audit.firstName}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'lastName', audit.lastName)  ? 'black' : 'red'  }">{{audit.lastName}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'employeeId', audit.employeeId)  ? 'black' : 'red'  }">{{audit.employeeId}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'jobtitle', audit.jobtitle)  ? 'black' : 'red'  }">{{audit.jobtitle}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'employeeExpertise', audit.employeeExpertise)  ? 'black' : 'red'  }">{{audit.employeeExpertise}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'jobType', audit.jobType)  ? 'black' : 'red'  }">{{audit.jobType}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'startDate', audit.startDate)  ? 'black' : 'red'  }">{{audit.startDate | date: 'dd-MM-yyyy'}}</td>
                                            <!-- <td [ngStyle]="{'color': getColorCodeForHistory(i, 'company', audit.company)  ? 'black' : 'red'  }">{{audit.company}}</td> -->
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'payType', audit.payType)  ? 'black' : 'red'  }">{{audit.payType}}</td>
                                            <td [ngStyle]="{'color': getColorCodeForHistory(i, 'isActive', audit.isActive)  ? 'black' : 'red'  }">{{audit.isActive}}</td>
                                        <td >{{audit.updatedBy}}</td>
                                        <td>{{audit.updatedDate | date: 'dd-MM-yyyy'}}</td>
                                    </tr>
                            </tbody>                        
                        </table>
                        <ng-template #noDatavailable>
                            <div class="text-center"> 
                                    <img src="../../../../assets/images/binoculars.png" style="height: 100px; width: 100px;">
                                    <h4 style="color: #ff5663;">No History Found </h4>
                            </div>
                        </ng-template>  
                    </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger-cstm" data-dismiss="modal">Close</button>
                </div>
              </div>
          
            </div>
          </div>