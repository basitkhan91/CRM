<div class="right_col" role="main">
  <div class="x_content">
    <div class="card">
      <div class="card-header">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb rpo-bcrumb" style="background-color: transparent;">
            <li class="breadcrumb-item active" aria-current="page">
              Sales Order Quote
            </li>
            <li class="breadcrumb-item" aria-current="page">
              Create New SO Quote
            </li>
          </ol>
        </nav>
      </div>
      <div class="form-controls">
        <form #newSalesQuoteForm="ngForm" class="form-horizontal" (ngSubmit)="onSubmit()">
          <div class="col-md-12 col-sm-12 col-12">
            <div class="col-md-2 column">
              <div class="form-group">
                <label>Quote Type <span class="clr-red">*</span></label>
                <select name="quoteTypeId" [(ngModel)]="salesQuote.quoteTypeId" required>
                  <option *ngFor="let type of salesQuote.salesQuoteTypes" [ngValue]="type.id">{{ type.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Open Date<span class="clr-red">*</span></label>
                <p-calendar name="openDate" [(ngModel)]="salesQuote.openDate" [showIcon]="true" (onSelect)="onChangeOpenDate()"></p-calendar>
              </div>
              <div class="form-group">
                <label>Cust Request Date<span class="clr-red">*</span></label>
                <p-calendar name="customerRequestDate" [(ngModel)]="salesQuote.customerRequestDate" [showIcon]="true">
                </p-calendar>
              </div>
              <div class="form-group">
                <label>Promised Date<span class="clr-red">*</span></label>
                <p-calendar name="customerPromisedDate" [(ngModel)]="salesQuote.customerPromisedDate" [showIcon]="true">
                </p-calendar>
              </div>
              <div class="form-group">
                <label>Estimated Ship Date<span class="clr-red">*</span></label>
                <p-calendar name="estimatedShipDate" [(ngModel)]="salesQuote.estimatedShipDate" [showIcon]="true">
                </p-calendar>
              </div>
              <div class="form-group">
                <label>Valid For (Days)<span class="clr-red">*</span></label>
                <input type="text" class="form-control" name="validForDays" [(ngModel)]="salesQuote.validForDays" (change)="onChangeValidForDays()" />
              </div>
              <div class="form-group">
                <label>Quote Exp Date<span class="clr-red">*</span></label>
                <p-calendar name="quoteExpiryDate" [(ngModel)]="salesQuote.quoteExpiryDate" [showIcon]="true" (onSelect)="onChangeQuoteExpiryDate()">
                </p-calendar>
              </div>
              <div class="form-group">
                <label>Priority<span class="clr-red">*</span></label>
                <select name="priorityId" [(ngModel)]="salesQuote.priorityId" required>
                  <option *ngFor="let p of salesQuote.priorities" [ngValue]="p.priorityId">{{ p.description }}</option>
                </select>
              </div>
            </div>
            <div class="col-md-2 column-seperator">
              <div class="form-group">
                <label>Account Type <span class="clr-red">*</span></label>
                <select name="accountTypeId" required [(ngModel)]="salesQuote.accountTypeId">
                    <option *ngFor="let accountType of accountTypes" [ngValue]="accountType.customerTypeId">{{ accountType.description }}</option>
                </select>
              </div>
              <div class="form-group sales-quote-customer-input">
                <label>Customer Name<span class="clr-red">*</span></label>
                <input type="text" class="form-control" [(ngModel)]="salesQuote.customerName" name="customerName"
                  [disabled]="true" />
                  <span>
                    <a class="btn btn-info boxed-float-btn nobg"
                       data-toggle="tooltip"
                       (click)="viewSelectedRow()"
                       
                       matTooltip="View">
                        <i class="fa fa-eye"></i>
                    </a>
                </span>
                <!-- <p-autoComplete
                  [(ngModel)]="salesQuote.customerName"
                  [suggestions]="customers"
                  (completeMethod)="searchCustomerByName($event)"
                  [dropdown]="false"
                  name="customerId"
                  field="name"
                  (onSelect)="onCustomerNameSelect($event)"
                  [disabled]="true"
                >
                  <ng-template let-value pTemplate="selectedItem">
                    <span>{{ value.name }}</span>
                  </ng-template>
                  <ng-template let-brand pTemplate="item">
                    <div class="ui-helper-clearfix">
                      <div>{{ brand.name }}</div>
                    </div>
                  </ng-template>
                </p-autoComplete> -->
              </div>
              <div class="form-group">
                <label>Customer Code<span class="clr-red">*</span></label>
                <input type="text" class="form-control" [(ngModel)]="salesQuote.customerCode" name="customerCode"
                  [disabled]="true" />
              </div>
              <div class="form-group">
                <label>Customer Contact<span class="clr-red">*</span></label>
                <select [(ngModel)]="salesQuote.customerContactId" [ngModelOptions]="{standalone: true}">
                  <option value='-1'>--Select</option>
                  <option *ngFor="let contact of customerContactList" [ngValue]="contact.contactId">{{contact.firstName}} {{contact.lastName}} - {{ contact.workPhone }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Customer Ref<span class="clr-red">*</span></label>
                <input type="text" class="form-control" name="customerReferenceName" [(ngModel)]="salesQuote.customerReferenceName" />
              </div>
              <div class="form-group" *ngIf="isEdit">
                <label>Status</label>
                <div class="col-md-5">
                <select name="status" [(ngModel)]="salesQuote.statusId">
                    <option value='-1'>--Select</option>
                    <ng-container *ngFor="let s of salesQuote.status">
                      <option  *ngIf="s.displayInDropdown" [ngValue]="s.id">{{ s.name }}</option>
                    </ng-container>
                    
                </select>
                </div>
                <div class="col-md-7">
                  
                  <p-calendar class="statusChangeDate" name="statusChangeDate" [(ngModel)]="salesQuote.statusChangeDate" [showIcon]="false" [disabled]="true">
                  </p-calendar>
                </div>
              </div>
              <div class="form-group">
                <label>Contract Ref</label>
                <input type="text" class="form-control" name="contractReferenceName" [(ngModel)]="salesQuote.contractReferenceName" />
              </div>
              <div class="form-group">
                <label>Sales Person</label>
              <p-autoComplete
              class="autocomp-customer-cstm"
              name="salesPersonName"
              [(ngModel)]="salesQuote.salesPersonName"
              [suggestions]="firstCollection"
              [forceSelection]="true"
              emptyMessage="No Match Found"
              field="firstName"
              (completeMethod)="filterfirstName($event)"
              [size]="30"
              [minLength]="1"
              [dropdown]="true"
            >
            </p-autoComplete>
              </div>
             
            </div>
            <div class="col-md-2 column column-seperator">
                <div class="form-group">
                    <label>Agent</label>
                  <p-autoComplete
                  class="autocomp-customer-cstm"
                  name="agentName"
                  [(ngModel)]="salesQuote.agentName"
                  [suggestions]="firstCollection"
                  [forceSelection]="true"
                  emptyMessage="No Match Found"
                  field="firstName"
                  (completeMethod)="filterfirstName($event)"
                  [size]="30"
                  [minLength]="1"
                  [dropdown]="true"
                >
                </p-autoComplete>
                  </div>
              <div class="form-group">
                <label>Customer Service Rep</label>
              <p-autoComplete
              class="autocomp-customer-cstm"
              name="customerServiceRepName"
              [(ngModel)]="salesQuote.customerServiceRepName"
              [suggestions]="firstCollection"
              [forceSelection]="true"
              emptyMessage="No Match Found"
              field="firstName"
              (completeMethod)="filterfirstName($event)"
              [size]="30"
              [minLength]="1"
              [dropdown]="true"
            >
            </p-autoComplete>
              </div>
              <div class="form-group">
                <label>Probability</label>
                <select name="probability" [(ngModel)]="salesQuote.probabilityId">
                  <option value='-1'>--Select</option>
                  <option *ngFor="let p of percents" [ngValue]="p.value">{{ p.label }}</option> 
                </select>
              </div>
              <div class="form-group">
                <label>Lead Source</label>
                <select name="leadSource" [(ngModel)]="salesQuote.leadSourceId">
                    <option value='-1'>--Select</option>
                    <option *ngFor="let ls of salesQuote.leadSources" [ngValue]="ls.id">{{ ls.name }}</option>
                </select>
              </div>
              <div class="form-group">
                <label>Credit Limit &amp; terms</label>
                <div class="col-md-5">
                  <input type="text" class="form-control" name="creditLimit" [(ngModel)]="salesQuote.creditLimit"  [disabled]="true" />
                </div>
                <div class="col-md-7">
                  <select name="creditLimitTermsId" [(ngModel)]="salesQuote.creditLimitTermsId"  [disabled]="true">
                      <option value='-1'>--Select</option>
                    <option *ngFor="let ct of creditTerms" [ngValue]="ct.value">{{ ct.label }}</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>Employee <span class="clr-red">*</span></label>
              <p-autoComplete
              class="autocomp-customer-cstm"
              name="employeeName"
              [(ngModel)]="salesQuote.employeeName"
              [suggestions]="firstCollection"
              [forceSelection]="true"
              emptyMessage="No Match Found"
              field="firstName"
              (completeMethod)="filterfirstName($event)"
              [size]="30"
              [minLength]="1"
              [dropdown]="true"
              required
            >
            </p-autoComplete>
              </div>
              <div class="form-group" style="margin-top: 5px;">
                <p-checkbox name="restrictPMA" [(ngModel)]="salesQuote.restrictPMA" binary="true" label="Restrit PMA">
                </p-checkbox>
              </div>
              <div class="form-group" style="margin-top: 5px;">
                <p-checkbox name="restrictDER" [(ngModel)]="salesQuote.restrictDER" binary="true" label="Restrit DER">
                </p-checkbox>
              </div>
            </div>
            <div class="col-md-2 column column-seperator" >
              <div class="form-group" *ngIf="selectedApprovers.length>0">
                <label>Quote Approved By</label>
                <select name="quoteApprovedById" [(ngModel)]="salesQuote.quoteApprovedById">
                  <option value='-1'>--Select</option>
                  <option *ngFor="let employee of selectedApprovers" [ngValue]="employee.employeeId">
                      {{employee.firstName}}
                      </option>
                </select>
              </div>
              <div class="form-group" *ngIf="selectedApprovers.length>0">
                <label>Approved Date</label>
                <p-calendar name="approvedDate" [(ngModel)]="salesQuote.approvedDate" [showIcon]="true"></p-calendar>
              </div>
              <div class="form-group">
                <label>Currency <span class="clr-red">*</span></label>
                <select name="currencyId" required [(ngModel)]="salesQuote.currencyId">
                  <option value='-1'>--Select</option>
                  <option *ngFor="let currencyName of allCurrencyInfo" [ngValue]="currencyName.currencyId">
                    {{currencyName.symbol}}
                    </option>
                </select>
              </div>
              <div class="form-group">
                <label>Warnings </label>
                <select name="warningId" required [(ngModel)]="salesQuote.warningId" (change)="onWarningSelect(salesQuote.warningId)">
                  <option value='-1'>--Select</option>
                  <option *ngFor="let customerWarning of customerWarningData" [ngValue]="customerWarning.customerWarningId">
                    {{customerWarning.warningMessage}}
                    </option>
                </select>
              </div>
 
                <div class="form-group memo-popup-cstm" style="margin-top: 12px;">
									<label>Memo</label>
									<span pTooltip="{{salesQuote.memo}}" tooltipPosition="top"><input type="text" name="memo" class="form-control" class="form-control" value="{{salesQuote.memo}}" disabled /></span>
									<i class="fa fa-info-circle fa-lg" data-toggle="modal" data-target="#add-description" pTooltip="{{salesQuote.memo}}" tooltipPosition="top" (click)="onAddDescription('memo')"></i>
                </div>
                <div class="form-group memo-popup-cstm" style="margin-top: 12px;">
									<label>Notes</label>
									<span pTooltip="{{salesQuote.notes}}" tooltipPosition="top"><input type="text" name="notes" class="form-control" class="form-control" value="{{salesQuote.notes}}" disabled /></span>
									<i class="fa fa-info-circle fa-lg" data-toggle="modal" data-target="#add-description" pTooltip="{{salesQuote.notes}}" tooltipPosition="top" (click)="onAddDescription('notes')"></i>
                </div>
             
            </div>

            <div>

              <div class="col-md-2 column column-seperator" >
									<div class="card-header" style="padding: 10px 12px;">
										<h5 style="margin-bottom: 0; font-size: 12px;">Management Structure <span class="clr-red">*</span></h5>
									</div>
									<div class="card-body">
                    <div class="form-group">
                      <p-dropdown placeholder="Select Legal Entity"
                                  name="company"
                                  #wocompanyId="ngModel"
                                  required
                                  [options]="legalEntityList"
                                  class="p-dropdown-custom-md-2"
                                  (onChange)="selectedLegalEntity($event.value)"
                                  [(ngModel)]="salesQuote.companyId">
                      </p-dropdown>
                  </div>
                  <div class="form-group">
                      <p-dropdown placeholder="Select "
                                  name="bu"
                                  #wobu="ngModel"
                                  [options]="businessUnitList"
                                  class="p-dropdown-custom-md-2"
                                  (onChange)="selectedBusinessUnit($event.value)"
                                  [(ngModel)]="salesQuote.buId">
                      </p-dropdown>
                  </div>
                  <div class="form-group">
                      <p-dropdown placeholder="Select "
                                  name="division"
                                  #wodivision="ngModel"
                                  [options]="divisionList"
                                  class="p-dropdown-custom-md-2"
                                  (onChange)="selectedDivision($event.value)"
                                  [(ngModel)]="salesQuote.divisionId">
                      </p-dropdown>
                  </div>
                  <div class="form-group">
                      <p-dropdown placeholder="Select "
                                  name="department"
                                  #wodepartment="ngModel"
                                  [options]="departmentList"
                                  class="p-dropdown-custom-md-2"
                                  (onChange)="selectedDepartment($event.value)"
                                  [(ngModel)]="salesQuote.departmentId">
                      </p-dropdown>
                  </div>
									</div>
								</div>

            </div>
          </div>
          <ng-container>
            <p-tabView class="pas-tabview">
              <p-tabPanel header="PN" [selected]="true">
                <app-sales-part-number [salesQuote]="salesQuote"></app-sales-part-number>
              </p-tabPanel>
              <p-tabPanel header="Approve">
                <app-sales-approve></app-sales-approve>
              </p-tabPanel>
              <p-tabPanel header="Address">
                <app-sales-address [customerId]="customerId"></app-sales-address>
              </p-tabPanel>
            </p-tabView>
          </ng-container>
          <div class="card-footer" style="text-align: right;">
            <div class="col-md-1 col-sm-1 col-1">
              &nbsp;
            </div>
            <div class="col-md-11 col-sm-11 col-11"> 
              <button type="submit" *ngIf="!isEdit" class="btn pull-right submit-btn btn btn-primary">Submit</button>
              <button type="submit" *ngIf="isEdit" class="btn pull-right submit-btn btn btn-primary">Update</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="add-description" role="dialog" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-sm" style="max-width: 400px !important;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Edit {{tempMemoLabel}}</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>{{tempMemoLabel}}</label>
          <textarea class="form-control" name="tempMemo" [(ngModel)]="tempMemo" value={{tempMemo}}></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="onSaveDescription()">Save</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<ng-template #errorMessagePop let-c="close" let-d="dismiss">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" (click)="closeErrorMessage()">&times;</button>
    <h4 class="modal-title"> Please Enter (*) Mandatory Fields</h4>
  </div>
  <div class="modal-body">
    <p *ngFor="let error of errorMessages" [ngStyle]="{'color':'red'}"> {{ error }} </p>
  </div>
  <div class="modal-footer">
   
    <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="closeErrorMessage()">Close</button>
  </div>
</ng-template>

<!--
<p-dialog header="Alert" [(visible)]="display" [modal]="true" [dismissableMask]="true" maximizedLeft="140px"
          [width]="350" [minWidth]="200" [responsive]="true"
          [minY]="1050" [baseZIndex]="1100000" position="center center" widgetVar="errorMessages" onShow="PF('errorMessages').initPosition()">
    <h5 [ngStyle]="{'color':'red'}">
        Please Enter (*) Mandatory Fields
    </h5>
    <p *ngFor="let error of errorMessages" [ngStyle]="{'color':'red'}"> {{ error }} </p>
    <p-footer>
        <button type="button" pButton icon="pi pi-check" (click)="display=false" label="Close"></button>
    </p-footer>

</p-dialog>
-->
