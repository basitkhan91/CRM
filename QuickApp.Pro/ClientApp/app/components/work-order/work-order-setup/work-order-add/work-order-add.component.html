<div [@fadeInOut] class="page-content">
    <div class="right_col" role="main">
       
        <div class="col-md-12">
            <div class="card" *ngIf="!isSubWorkOrder" style="">
            <form  #workOrderForm="ngForm" >
                <div class="x_content">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item" aria-current="page">Work Order</li>
                            <li class="breadcrumb-item active" aria-current="page">Work Order Setup</li>
                            <li *ngIf="isSubWorkOrder" class="breadcrumb-item active" aria-current="page">Sub WOrkOrder </li>
                        </ol>
                    </nav>
                    <div class="pheading">
                        <h4 *ngIf="!isSubWorkOrder" class="page-heading">Work Order Setup</h4>
                        <h4 *ngIf="isSubWorkOrder" class="page-heading">Sub Work Order Setup</h4>
                    </div>
                    <div class="clear"></div>
                    <div class="card">
                        <div class="card-body">
                            <div class="col-sm-12 link-block">
                                <h4 (click)="toggleDisplayMode()" style="cursor:pointer;">
                                    General Info
                                    <span [hidden]="isDetailedView" class="more-details-btn">(More <i
                                            class="fa fa-caret-down"></i>)</span>
                                    <span [hidden]="!isDetailedView" class="less-details-btn">(Less <i
                                            class="fa fa-caret-up"></i>)</span>
                                </h4>
                                <div class="clear"></div>
                            </div>
                           <div class="less-details" [hidden]="isDetailedView">
                                <div class="clear"></div>
                                <hr>
                                <div class="col-sm-3">
                                    <div class="form-group col-sm-12">
                                        <label class="control-label col-sm-4">WO Num
                                        </label>
                                        <div class="col-sm-7" data-toggle="tooltip"
                                            title="This field should display 'creating' before the header info is saved WO ID should be autogenerated.  Allow siffices or prefeices depending on what config in the WO setup screen">
                                            <input type="text" class="form-control" value="Creating" disabled="">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group col-sm-12">
                                        <label class="control-label col-sm-4">MPN</label>
                                        <div class="col-sm-7" data-toggle="tooltip"
                                            title="This field should display 'creating' before the header info is saved WO ID should be autogenerated.  Allow siffices or prefeices depending on what config in the WO setup screen">
                                            <input type="text" class="form-control"
                                                value="12548454-1, 125487457-A, 78546687-114F" disabled="">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group col-sm-12">
                                        <label class="control-label col-sm-4">Cust Name</label>
                                        <div class="col-sm-7" data-toggle="tooltip"
                                            title="This field should display 'creating' before the header info is saved WO ID should be autogenerated.  Allow siffices or prefeices depending on what config in the WO setup screen">
                                            <input type="text" class="form-control" value="Shabbir Ahmad" disabled="">
                                        </div>
                                    </div>
                                </div>
                            </div> 
                            <div class="clear"></div>
                            <div class="more-details" [hidden]="!isDetailedView">
                                <div class="col-md-12 row">
                                    <div class="col-md-3 col-offset-3">
                                        <label style="width: auto;">
                                            <input type="radio" [value]=true   name="type" #type="ngModel"
                                                [(ngModel)]="workOrderGeneralInformation.isSinglePN" 
                                                >
                                            Single MPN
                                        </label>
                                        <label style="width: auto;">
                                            <input type="radio" [value]=false name="type" #type="ngModel"
                                                [(ngModel)]="workOrderGeneralInformation.isSinglePN" >
                                            Multiple MPN
                                        </label>
                                    </div>
                                    <div class="col-md-6">

                                        <label class="control-label col-sm-4 w80">WO Type</label>
                                        <label style="width: auto;">
                                            <input type="radio" value="1" name="dealer"
                                                #dealer="ngModel"
                                                [(ngModel)]="workOrderGeneralInformation.workOrderTypeId"
                                                (click)="woDealerChange($event.target.value)">
                                            Customer
                                        </label>
                                        <label style="width: auto;">
                                            <input type="radio" value="2" name="dealer"  #dealer="ngModel" [(ngModel)]="workOrderGeneralInformation.workOrderTypeId"
                                                (click)="woDealerChange($event.target.value)">
                                                Internal
                                        </label>

                                        <label style="width: auto;">
                                            <input type="radio" value="3" name="dealer"  #dealer="ngModel"
                                                [(ngModel)]="workOrderGeneralInformation.workOrderTypeId"
                                                (click)="woDealerChange($event.target.value)">
                                           Tear Down
                                        </label>
                                        <label style="width: auto;">
                                            <input type="radio" value="4" name="dealer"  #dealer="ngModel"
                                                [(ngModel)]="workOrderGeneralInformation.workOrderTypeId"
                                                (click)="woDealerChange($event.target.value)">
                                           Shop  Services
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-3 w500">
                                    <div class="form-group col-sm-12">
                                        <label class="control-label col-sm-4 w80">WO Type</label>
                                        <div class="col-sm-7 w400">
                                            <div *ngFor="let workOrderType of workOrderTypes">
                                                <label data-toggle="tooltip" title="External" style="width: auto;">
                                                    <input type="radio" name="work-type"  
                                                          
                                                        value="workOrder_{{workOrderType.id}}"
                                                        [checked]="workOrder.workOrderTypeId == workOrderType.id">
                                                    {{workOrderType.description}}
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clear"></div>
                                <hr>
                                <div class="form-row">
                                    <div class="col-md-2">
                                        <div class="form-group ">
                                            <label for="workflownum">WO Num
                                            </label>
                                            <input class="form-control" data-toggle="tooltip" type="text" 
                                                name="workOrderNumber" #workOrderNumber="ngModel"
                                                 disabled [(ngModel)]="workOrderGeneralInformation.workOrderNumber"
                                                title="This field should display 'creating' before the header info is saved WO ID should be autogenerated.  Allow siffices or prefeices depending on what config in the WO setup screen" />
                                        </div>
                                        <div class="form-group">
                                            <label for="opendate">Open Date <span class="clr-red">*</span>
                                            </label>
                                            <p-calendar [showIcon]="true" class="calender-cstm"  name="openDate" #openDate="ngModel"  required
                                                [(ngModel)]="workOrderGeneralInformation.openDate"></p-calendar>
                                        </div>
                                        <div class="form-group">
                                            <label for="credit" style="width: 100%;">WO Status
                                                <span class="clr-red">*</span> </label>
                                            <p-dropdown [options]="workOrderStatusList" name="workOrderStatus" #workOrderStatus="ngModel"  placeholder="Select Status" class="p-dropdown-custom-md-Header" [(ngModel)]="workOrderGeneralInformation.workOrderStatusId"  required>
                                              </p-dropdown>

                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label for="customername">Customer Name
                                                <span class="clr-red">*</span>
                                                <span *ngIf="workOrderGeneralInformation.customerId !== null ">
                                                        <a data-toggle="tooltip" pTooltip="Customer Email: {{workOrderGeneralInformation.customerId.customerEmail}}, Customer Phone: {{workOrderGeneralInformation.customerId.customerPhoneNo}}" tooltipPosition="bottom" title=""  (click)="viewCustomerDetails(workOrderGeneralInformation.customerId.customerId)"  >
                                                            <i class="fa fa-eye"></i>
                                                        </a>
                                                    </span>
                                            </label>
                                            <p-autoComplete field="customerName" [(ngModel)]="workOrderGeneralInformation.customerId"
                                       
                                              name="customerName"
                                              errorMessage="Records not found" 
                                              [forceSelection]="true"
                                              (onSelect)="selectCustomer($event, workOrderGeneralInformation )"
                                              [suggestions]="customerNamesList" 
                                              (completeMethod)="filterCustomerName($event)"
                                              (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'customerId' )"
                                               [size]="30" [minLength]="1"
                                               #customerName="ngModel"
                                               required
                                              [dropdown]="false" class="p-autoComplete-ctsm" >
                       
                                        </p-autoComplete>

                                        <div *ngIf="customerName.invalid && (customerName.dirty || customerName.touched)" class="alert alert-danger alert-danger-cstm">
                                            <div *ngIf="customerName.errors.required">
                                                <small> Customer Name is required </small>
                                            </div>
                                        </div>
                                
                                        <div class="clear"></div>
 
                                        </div>
                                  
                                        <div class="form-group ">
                                            <label for="customerref">Customer Ref
                                                <span class="clr-red">*</span>
                                            </label>

                                            <input type="text" class="form-control wo-input" name="contactRef"  #contactRef="ngModel" [(ngModel)]="workOrderGeneralInformation.customerReference"  required>

                                            
                                        <div *ngIf="contactRef.invalid && (contactRef.dirty || contactRef.touched)" class="alert alert-danger alert-danger-cstm">
                                            <div *ngIf="contactRef.errors.required">
                                                <small> Contact Ref is required </small>
                                            </div>
                                        </div>
                                
                                        </div>
                                        
                                    </div>
                                    <div class="col-md-2">
                                            <div class="form-group">
                                                    <div class="checkbox-cstm">
                                                        <label>
                                                            <input type="checkbox" name="contract" #contract="ngModel" [(ngModel)]="workOrderGeneralInformation.isContractAvl">
                                                            <span class="cr"><i class="cr-icon pi pi-check"></i></span>
                                                            Contract
                                                        </label>
                                                        <input *ngIf="workOrderGeneralInformation.isContractAvl" type="text" class="form-control"     name="contract"  #contract="ngModel"  [(ngModel)]="workOrderGeneralInformation.contract">
                                                    </div>
                                                </div>
                                                    <div class="form-group ">
                                                        <label for="customercontact">CSR
                                                          <span class="clr-red">*</span>
                                                        </label>
                                                        <input type="text" class="form-control wo-input" [(ngModel)]="workOrderGeneralInformation.csr" name="csr"   #csr="ngModel"  required />

                                                        <div *ngIf="csr.invalid && (csr.dirty || csr.touched)" class="alert alert-danger alert-danger-cstm">
                                                            <div *ngIf="csr.errors.required">
                                                                <small> CSR is required </small>
                                                            </div>
                                                        </div>
                                                      </div>
                                    </div>
                                    
                                    <div class="col-md-3">
                                        <div class="form-group">
                      
                                            <label for="credit">Credit Terms &amp; Limit
                                                <span class="clr-red">*</span> </label>
                                            <div class="col-md-12">
                                                <div class="col-md-4">
                                                    <input type="number" class="form-control wo-input" 
                                                    name="creditLimit"  #creditLimit="ngModel"
                                                    [(ngModel)]="workOrderGeneralInformation.creditLimit"  required>
                                                    
                                                    <div *ngIf="creditLimit.invalid && (creditLimit.dirty || creditLimit.touched)" class="alert alert-danger alert-danger-cstm">
                                                        <div *ngIf="creditLimit.errors.required">
                                                            <small> Credit Limit </small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <p-dropdown class="p-dropdown-custom-md "  placeholder="Select CreditTerms"
                                                    name="creditTermsId"  #creditTermsId="ngModel"
                                                    [options]="creditTerms"  [(ngModel)]="workOrderGeneralInformation.creditTermsId"  required>
                                                    <div *ngIf="creditTermsId.invalid && (creditTermsId.dirty || creditTermsId.touched)" class="alert alert-danger alert-danger-cstm">
                                                        <div *ngIf="creditTermsId.errors.required">
                                                            <small> CreditTerms Type   </small>
                                                        </div>
                                                    </div>
                                                  </p-dropdown>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group ">
                                            <label for="employee" style="margin-top: 10px;">Employee
                                                <span class="clr-red">*</span> </label>

                                                <p-autoComplete field="label" [(ngModel)]="workOrderGeneralInformation.employeeId"
                                            
                                              name="employees"
                                              #employees="ngModel"
                                              errorMessage="Records not found" 
                                              [forceSelection]="true"
                                              [dropdown]="true"
                                              [suggestions]="employeeList" 
                                              (completeMethod)="filterEmployee($event)"
                                              (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'employeeId' )"
                                               [size]="30" [minLength]="1"
                                              [dropdown]="true" class="p-autoComplete-ctsm"   required>
                                        </p-autoComplete>
                                        <div *ngIf="employees.invalid && (employees.dirty || employees.touched)" class="alert alert-danger alert-danger-cstm">
                                            <div *ngIf="employees.errors.required">
                                                <small> Employee  is required </small>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="form-group ">

                                            <label for="employee">Salesperson
                                                <span class="clr-red">*</span> </label>

                                                <p-autoComplete field="label" [(ngModel)]="workOrderGeneralInformation.salesPersonId"
                                            
                                                name="salesPerson"
                                                #salesPerson="ngModel"
                                                errorMessage="Records not found" 
                                                [forceSelection]="true"
                                                [dropdown]="true"
                                                [suggestions]="salesPersonList" 
                                                (completeMethod)="filterSalesPerson($event)"
                                                (onClear)="clearautoCompleteInput(workOrderGeneralInformation, 'salesPersonId' )"
                                                 [size]="30" [minLength]="1"
                                                [dropdown]="true" class="p-autoComplete-ctsm"  required >

                                               
                         
                                          </p-autoComplete>
                                          <div *ngIf="salesPerson.invalid && (salesPerson.dirty || salesPerson.touched)" class="alert alert-danger alert-danger-cstm">
                                              <div *ngIf="salesPerson.errors.required">
                                                  <small> SalesPerson  is required </small>
                                              </div>
                                          </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                            <div class="card">
                                                    <div class="card-body">
                                                        <h5 class="po-head-15f" >Management Structure <span class="clr-red">*</span>  </h5>
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                          <p-dropdown
                                                            placeholder="Select Legal Entity"
                                                            name="company"
                                                            #wocompanyId="ngModel"
                                                            required
                                                            [options]="legalEntityList"
                                                            class="p-dropdown-custom-md-2"
                                                            (onChange)="selectedLegalEntity($event.value)"
                                                            [(ngModel)]="managementStructure.companyId"
                                                          >
                                                          </p-dropdown>
                                                          </div>
                                                           <div class="form-group">
                                                              <p-dropdown
                                                                placeholder="Select "
                                                                name="bu"
                                                                #wobu="ngModel"
                                                                [options]="businessUnitList"
                                                                class="p-dropdown-custom-md-2"
                                                                (onChange)="selectedBusinessUnit($event.value)"
                                                                [(ngModel)]="managementStructure.buId"
                                                              >
                                                              </p-dropdown>
                                                              </div>
                                                              <div class="form-group">
                                                                  <p-dropdown
                                                                    placeholder="Select "
                                                                    name="division"
                                                                    #wodivision="ngModel"
                                                                    [options]="divisionList"
                                                                    class="p-dropdown-custom-md-2"
                                                                    (onChange)="selectedDivision($event.value)"
                                                                    [(ngModel)]="managementStructure.divisionId"
                                                                  >
                                                                  </p-dropdown>
                                                                  </div>
                                                                  <div class="form-group">
                                                                      <p-dropdown
                                                                        placeholder="Select "
                                                                        name="department"
                                                                        #wodepartment="ngModel"
                                                                        [options]="departmentList"
                                                                        class="p-dropdown-custom-md-2"
                                                                        (onChange)="selectedDepartment($event.value)"
                                                                        [(ngModel)]="managementStructure.departmentId"
                                                                      >
                                                                      </p-dropdown>
                                                                      </div> 
                                                        </div>
                                                    </div>
                                                  </div>

                                    </div>
                                    <div class="clear"></div>
                                    <hr>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-12 po-ro-setup"> </div>
                        <div class="h200"> &nbsp;</div>
                    </div>
                </div>
                <div>
                <button *ngIf="!workOrderGeneralInformation.isSinglePN" class="btn btn-primary-cstm pull-right" (click)="addMPN()">Add MPN</button>
              </div>
                <div class="table-responsive" style="height: 300px;">
                 
                    <!-- <table class="table table-bordered table-striped table-sorting mpn-list-table mpn-list-table-cstm" -->
                        <table class="table table-bordered table-striped table-fixed table-sorting mpn-list-table"
                        id="mpn-list-table">
                        <thead>
                            <tr>
                                <th rowspan="2">MPN *</th>
                                <th rowspan="2">MPN Description *</th>
                                <th rowspan="2">Revised MPN</th>
                                <th rowspan="2">Work Scope *</th>
                                <th rowspan="2">NTE</th>
                                <!-- <th rowspan="2">Qty *</th> -->
                                <th rowspan="2">Condition Id *</th>
                                <th rowspan="2">Stock Line Num *</th>
                                <th rowspan="2">Serial Num </th>
                                <th rowspan="2">CMM/Pub Ref</th>
                                <th rowspan="2">Workflow ID </th>
                                <th rowspan="2">Stage *</th>
                                <th rowspan="2">Status *</th>
                                <th rowspan="2">Priority *</th>
                                <th rowspan="2">Customer Request Date *</th>
                                <th rowspan="2">Promised Date *</th>
                                <th rowspan="2">Est. Comp Date *</th>
                                <th rowspan="2">Est. Ship Date *</th>
                                <th colspan="2">Restrictions</th>
                                <th rowspan="2">Tech Name</th>
                                <th rowspan="2">Tech Station</th>
                                <th rowspan="2">Tear Down Report</th>
                                <th colspan="2">TAT (Days)</th>
                                <th rowspan="2"></th>
                                <!--<th rowspan="2"></th>
                            <th rowspan="2"></th>-->
                            </tr>
                            <tr>
                                <th>PMA</th>
                                <th>DER</th>
                                <th>Current</th>
                                <th>Standard</th>
                                <!--<th></th>
                            <th></th>-->
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="mpn-row" style="display: table-row;"
                                *ngFor="let workOrderPartNumber of workOrderGeneralInformation.partNumbers; let i=index;">
                                <td>

                                    <p-autoComplete field="partNumber" [(ngModel)]="workOrderPartNumber.masterPartId"
                          
                                    name="mpn{{i}}"  #mpn="ngModel"
                                    errorMessage="Records not found" 
                                    [forceSelection]="true"
                                    [dropdown]="true"
                                    [suggestions]="partNumberList" 
                                    (onSelect)="onSelectedPartNumber($event, workOrderPartNumber, i); getWorkFlowByPNandScope(workOrderPartNumber); getStockLineByItemMasterIdOnChangePN(workOrderPartNumber,i);"
                                    (completeMethod)="filterPartNumber($event)"
                                    (onClear)="clearautoCompleteInput(workOrderPartNumber, 'masterPartId' )"
                                     [size]="30" [minLength]="1"
                                    [dropdown]="true" class="p-autoComplete-ctsm"   required>
             
                              </p-autoComplete>
                                </td>
                                <td><input type="text"  class="form-control" 
                                  name="description{{i}}"  #description="ngModel"
                                  [(ngModel)]="workOrderPartNumber.description"  required  disabled></td>
                                <td>
                                    <p-autoComplete field="revisedPartNo" [(ngModel)]="workOrderPartNumber.mappingItemMasterId"
                                    name="revisedPartNo{{i}}"  #revisedPartNo="ngModel"
                                    errorMessage="Records not found" 
                                    [forceSelection]="true"
                                    [dropdown]="true"
                                    [suggestions]="getDynamicVariableData('revisedPartNumberList',i)" 
                                    (completeMethod)="filterRevisedPartNumber($event, i)"
                                     [size]="30" [minLength]="1"
                                    [dropdown]="true" class="p-autoComplete-ctsm"  >
                                  </p-autoComplete>
                                </td>
                                <td>
                                    <p-dropdown  placeholder="Select Work Scope"
                                    name="scope{{i}}"  #scope="ngModel" 
                                    [options]="workScopesList" class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.workOrderScopeId"
                                    (onChange)="getWorkFlowByPNandScope(workOrderPartNumber)"
                                    required
                                    >
                                      </p-dropdown>
                                </td>
                                <td><input type="text" class="form-control w50" [(ngModel)]="workOrderPartNumber.nte"  
                                  name="nte{{i}}"  #nte="ngModel" 
                                  disabled></td>
                                <td>
                                  <p-dropdown  placeholder="Select Condition" [options]="getDynamicVariableData('conditionList',i)"
                                  name="condition{{i}}"  #condition="ngModel" 
                                  (onChange)="getStockLineByItemMasterId(workOrderPartNumber.masterPartId,workOrderPartNumber.conditionId,  i);"
                                   class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.conditionId"  required>
                                    </p-dropdown>
                              </td>

                                <td>
                                    <p-dropdown  placeholder="Select StockLine" [options]="getDynamicVariableData('stockLineList',i)" 
                                    name="stockLine{{i}}"  #stockLine="ngModel" 
                                    class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.stockLineId"
                                    (onChange)="getSerialNoByStockLineId(workOrderPartNumber)"
                                    required
                                    >
                                      </p-dropdown>
  
                                </td>


                                <td><input type="text" class="form-control w100"
                                  name="serialNumber{{i}}"  #serialNumber="ngModel" 
                                  [(ngModel)]="workOrderPartNumber.serialNumber"   disabled >
                                </td>
                                <td>
                                    <p-dropdown placeholder="Select CMM" 
                                    name="cmm{{i}}"  #cmm="ngModel" 
                                    [options]="cmmList" class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.cmmId">
                                      </p-dropdown>
                                   
                    
                                </td>
                                <td>
                                    <span class="inline-block">
                                        <p-dropdown [options]="workFlowList" 
                                        name="workFlow{{i}}"  #workFlow="ngModel" 
                                        placeholder="None" class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.workflowId">
                                        </p-dropdown>
                                    </span>
                                </td>
                                <td>
                                    <p-dropdown [options]="workOrderStagesList" 
                                    name="stage{{i}}"  #stage="ngModel" 
                                    placeholder="Select Stage" class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.workOrderStageId"  required>
                                      </p-dropdown>
                                </td>
                                <td>
                                    <p-dropdown [options]="workOrderStatusList"  placeholder="Select Status" 
                                    name="status{{i}}"  #status="ngModel" 
                                    class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.workOrderStatusId"  required>
                                      </p-dropdown>
                                </td>
                                <td>
                                    <p-dropdown [options]="priorityList"  name="priority{{i}}"  #priority="ngModel"  class="p-dropdown-custom-md" [(ngModel)]="workOrderPartNumber.workOrderPriorityId"  required>
                                      </p-dropdown>
                                </td>
                                <td>
                                        <p-calendar [showIcon]="true" 
                                        name="customerRequestDate{{i}}"  class="calender-cstm" #customerRequestDate="ngModel"
                                        [(ngModel)]="workOrderPartNumber.customerRequestDate"   required  ></p-calendar>
                                <td>
                                        <p-calendar [showIcon]="true" 
                                        name="promisedDate{{i}}"  class="calender-cstm" #promisedDate="ngModel"
                                        [(ngModel)]="workOrderPartNumber.promisedDate"  required></p-calendar>
                                <td>
                                        <p-calendar [showIcon]="true" 
                                        name="estimatedCompletionDate{{i}}" class="calender-cstm"  #estimatedCompletionDate="ngModel"
                                        [(ngModel)]="workOrderPartNumber.estimatedCompletionDate"  required></p-calendar>
                                    </td>
                                <td>
                                        <p-calendar [showIcon]="true" class="calender-cstm" name="estimatedShipDate{{i}}"
                                        [(ngModel)]="workOrderPartNumber.estimatedShipDate" #estimatedShipDate="ngModel"  required></p-calendar>
                                   </td>
                                <td><input type="checkbox" class="form-control w60"       name="isPMA{{i}}"  #isPMA="ngModel" [(ngModel)]="workOrderPartNumber.isPMA" disabled >
                                </td>
                                <td><input type="checkbox" class="form-control w60"  name="isDER{{i}}"  #isDER="ngModel"  [(ngModel)]="workOrderPartNumber.isDER"  disabled>
                                </td>
                                <td>
                                  
                                    <p-autoComplete field="label" [(ngModel)]="workOrderPartNumber.technicianId"
                                            
                                    name="technician{{i}}"
                                    errorMessage="Records not found" 
                                    [forceSelection]="true"
                                    [dropdown]="true"
                                    [suggestions]="technicianList" 
                                    (completeMethod)="filterTechnician($event)"
                                     [size]="30" [minLength]="1"
                                       #technician="ngModel"
                                    [dropdown]="true" class="p-autoComplete-ctsm" >
             
                              </p-autoComplete>
                                </td>
                                <td>
                                    <p-dropdown placeholder="Select Tech Station" name="techStation{{i}}"  #techStatsion="ngModel"   [options]="technicalStationsList" class="p-dropdown-custom-md"  [(ngModel)]="workOrderPartNumber.techStationId">
                                      </p-dropdown>
                                   
                                </td>
                                <td>
                                    <p-dropdown  placeholder="Select Tear Down"  name="tearDown{{i}}"  #tearDown="ngModel"  [options]="tearDownReportList" class="p-dropdown-custom-md"  [(ngModel)]="workOrderPartNumber.tearDownReport" >
                                      </p-dropdown>

                                </td>
                                <td><input type="text" class="form-control w50" name="tatDaysCurrent{{i}}"  #tatDaysCurrent="ngModel"   [(ngModel)]="workOrderPartNumber.tatDaysCurrent" ></td>
                                <td><input type="text" class="form-control w50" name="tatDaysStandard{{i}}"  #tatDaysStandard="ngModel"   [(ngModel)]="workOrderPartNumber.tatDaysStandard"></td>
                              
                                <td><span *ngIf="!workOrderGeneralInformation.isSinglePN "  class="delete-row-btn"> <a
                                            class="btn btn-danger boxed-float-btn nobg"
                                            (click)="deleteMPN(i)"
                                            data-toggle="tooltip" title="Delete"><i
                                                class="fa fa-trash"></i></a>
                                    </span></td>
                            </tr>

                        </tbody>
                    </table>
                   
                  
                </div>
                <div>
                  <button class="btn btn-primary-cstm pull-right" *ngIf="!showTabsGrid && !isEdit" type="button"  [disabled]="!workOrderForm.valid" (click)="saveWorkOrder()">Save</button>
                  <button class="btn btn-primary-cstm pull-right" *ngIf="isEdit" type="button"  [disabled]="!workOrderForm.valid" (click)="saveWorkOrder()">Update</button>
                  <button  *ngIf="showTabsGrid" class="btn btn-primary-cstm pull-right" (click)="createQuote()"  >{{(workOrderQuoteId)?'Update Quote':'Create Quote'}}</button>
                </div>
            </form>
            </div>

 
            <div class="card" *ngIf="showTabsGrid" >
              <div *ngIf="showTabsMPNGrid">
                  <div class="card-header" *ngIf="!workOrderGeneralInformation.isSinglePN">
                      Multiple  MPN  
                    </div>
                    <div class="card-body" >
                        <div class="col-md-12" [hidden]="workOrderGeneralInformation.isSinglePN">
                            <div class="col-md-2">
                                <label class="control-label col-sm-3">MPN </label>
                                 <div class="col-sm-7">
    
                                    <p-dropdown [options]="mpnPartNumbersList" placeholder="Select Part Number" class="p-dropdown-custom-md" 
                                    (onChange)="changeofMPN($event.value)"
                                    >
                                      </p-dropdown> 
                                </div> 
                            </div>
    
                            <div  class="col-md-10" style="background-color: white" *ngIf="mpnGridData">
                                <div class="col-md-2">
                                    <label class="fs12">Description : </label>
                                    <span>{{mpnGridData.description}}</span>
                                </div>
                                <div class="col-md-2">
                                    <label class="fs12">Workscope : </label>
                                    <span>{{mpnGridData.workscope}}</span>
                                </div>
                                <div class="col-md-2">
                                    <label class="fs12">NTE : </label>
                                    <span>{{mpnGridData.nte}}</span>
                                </div>
    
                                <div class="col-md-2">
                                    <label class="fs12">Qty :</label>
                                    <span>{{mpnGridData.qty}}</span>
                                </div>
                                <div class="col-md-2">
                                    <label class="fs12" style="text-align: left;
                                        width: 41px;">Stage : </label>
                                    <span>{{mpnGridData.stage}}</span>
    
                                </div>
                                <div class="col-md-2">
                                    <label class="fs12">Priority :</label>
                                    <span>{{mpnGridData.priority}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
              </div>
                <div class="card-body" *ngIf="showGridMenu">
                   

                    <div  class="card col-md-12" style="background: #f1f1f1; margin-top: 10px;">
                        <ul class="nav nav-pills nav-pills-cstm" id="pills-tab" role="tablist">

                            <li class="nav-item" *ngIf="isSubWorkOrder">
                                <a id="pills-home-tab" role="tab" aria-controls="pills-home" aria-selected="true"
                                    [ngClass]="{active : gridActiveTab === 'workOrderMain'}"
                                
                                    (click)="gridTabChange('workOrderMain');  ">WorkOrder Main</a>
                            </li>
                            <li class="nav-item dropdown" *ngIf="workFlowId !==0" >
                                <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button"
                                    aria-haspopup="true" aria-expanded="false"
                                    [ngClass]="{active : gridActiveTab === 'workFlow' ||  subTabWorkFlow === 'editworkFlow' || subTabWorkFlow === 'createworkFlow'  }">Workflow</a>
                                <div class="dropdown-menu" >
                                    <a class="dropdown-item" (click)="subTabWorkFlowChange('viewworkFlow');">View WF</a>
                                    <a class="dropdown-item" (click)="subTabWorkFlowChange('editworkFlow')">Edit
                                        Existing WF</a>
                                    <!-- <a *ngIf="workFlowWorkOrderId == 0 " class="dropdown-item" (click)="subTabWorkFlowChange('createworkFlow')">Create New
                                        WF</a> -->
                                    <div class="dropdown-divider"></div>
                                </div>
                            </li>
                            <li class="nav-item">
                              <a id="pills-contact-tab" role="tab"
                                  [ngClass]="{active : gridActiveTab === 'materialList'}"
                             
                                  (click)="gridTabChange('materialList'); getMaterialListByWorkOrderId();">Material List </a>
                          </li>
                            <li class="nav-item">
                                <a id="pills-home-tab" role="tab" aria-controls="pills-home" aria-selected="true"
                                    [ngClass]="{active : gridActiveTab === 'labor'}"
                                
                                    (click)="gridTabChange('labor'); getWorkFlowLaborList(); ">labor</a>
                            </li>
                            <li class="nav-item">
                                <a id="pills-profile-tab" role="tab" aria-controls="pills-profile"
                                    [ngClass]="{active : gridActiveTab === 'equipment'}"
                                   
                                    (click)="gridTabChange('equipment');getEquipmentByWorkOrderId();">Assets</a>
                            </li>
                            <li class="nav-item" [hidden]="workOrderGeneralInformation.isSinglePN">
                                <a id="pills-contact-tab" role="tab" aria-controls="pills-contact"
                                    [ngClass]="{active : gridActiveTab === 'quote'}"
                                  
                                    (click)="gridTabChange('quote')">Quote</a>
                            </li>
                            <li class="nav-item dropdown">
                              <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button"
                                  aria-haspopup="true" [ngClass]="{active : gridActiveTab === 'main'}"
                                  (click)="gridTabChange('main')">Main
                                  Component </a>
                              <div class="dropdown-menu">
                                  <a class="dropdown-item" (click)="mainComponentTabSelected('existingRO')">Add to an Existing RO</a>
                                  <a class="dropdown-item" (click)="mainComponentTabSelected('createNewRO')" >Create New RO</a>
                                  <a class="dropdown-item" (click)="mainComponentTabSelected('interOrexternal')" >Convert Internal to External </a>
                                  <a class="dropdown-item" (click)="mainComponentTabSelected('returnmc')" >Return MC to Customer </a>
                              </div>
                          </li>
                          <li class="nav-item">
                            <a id="pills-contact-tab" role="tab"
                                [ngClass]="{active : gridActiveTab === 'billorInvoice'}"
                                (click)="gridTabChange('billorInvoice'); billingCreateOrEdit();">Billing/Invoicing</a>
                        </li>
                        <li class="nav-item">
                          <a id="pills-contact-tab" role="tab" [ngClass]="{active : gridActiveTab === 'shipping'}"
                              (click)="gridTabChange('shipping')">Shipping</a>
                      </li>
                      <li class="nav-item" *ngIf="!isSubWorkOrder">
                        <a id="pills-contact-tab" role="tab" [ngClass]="{active : gridActiveTab === 'subWO'}"
                            (click)="gridTabChange('subWO')">Sub-WO</a>
                    </li>

                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button"
                          aria-haspopup="true" aria-expanded="false"
                          [ngClass]="{active : gridActiveTab === 'communication'}"
                          (click)="gridTabChange('communication')">Communication</a>
                      <div class="dropdown-menu">
                          <a class="dropdown-item">Memo</a>
                          <a class="dropdown-item">Email</a>
                          <a class="dropdown-item">Phone</a>
                          <a class="dropdown-item">Text</a>
                          <a class="dropdown-item">Chat</a>
                      </div>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="pills-contact-tab" role="tab"
                        [ngClass]="{active : gridActiveTab === 'documents'}"
                        (click)="gridTabChange('documents')">Documents</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button"
                      aria-haspopup="true" aria-expanded="false"
                      [ngClass]="{active : gridActiveTab === 'workComplete'}"
                      (click)="gridTabChange('workComplete')">Work Complete</a>
                  <div class="dropdown-menu">
                      <a class="dropdown-item">Move to Finished Goods</a>
                      <a class="dropdown-item">No Work Performed -Return to Customer</a>
              <li class="dropdown-submenu">
                  <a class="test">Another dropdown <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                      <li><a>3rd level dropdown</a></li>
                      <li><a>3rd level dropdown</a></li>
                  </ul>
              </li>
      </div>
      </li>
      
      <li class="nav-item">
        <a class="nav-link" id="pills-contact-tab" role="tab"
            [ngClass]="{active : gridActiveTab === 'woanalysis'}"
            (click)="gridTabChange('woanalysis')">Wo Analysis</a>
    </li>

    <li class="nav-item">
      <a class="nav-link" id="pills-contact-tab" role="tab"
          [ngClass]="{active : gridActiveTab === 'laboranalysis'}"
          (click)="gridTabChange('laboranalysis')"> Labor Analysis</a>
  </li>

                            <!-- <li class="nav-item">
                                <a id="pills-contact-tab" role="tab" [ngClass]="{active : gridActiveTab === 'address'}"
                                    (click)="gridTabChange('address')">Addresses</a>
                            </li> -->

                            <li class="nav-item">
                              <a id="pills-contact-tab" role="tab" [ngClass]="{active : gridActiveTab === 'tearDown'}"
                                  (click)="gridTabChange('tearDown')">Tear Down</a>
                          </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                            aria-expanded="false" [ngClass]="{active : gridActiveTab === 'otherOptions'}"
                            (click)="gridTabChange('otherOptions')">Other Options</a>
                        <div class="dropdown-menu">
              
                            <a class="dropdown-item" (click)="otherOptionTabSelected('freight')" >Freight</a>
                            <a class="dropdown-item" (click)="otherOptionTabSelected('contactGrid')">Contact Grid</a>
                            <a class="dropdown-item" (click)="otherOptionTabSelected('accounting')" >Accounting</a>
                            <a class="dropdown-item" (click)="otherOptionTabSelected('charges')">Charges</a>
                            <a class="dropdown-item" (click)="otherOptionTabSelected('exclusions')" >Exclusion </a>
                        </div>
                    </li>
                    </ul>
                    <br>
                    <div *ngIf="isWorkOrderMainView" [ngClass]="{hidedata :  gridActiveTab !== 'workOrderMain' }">
                        <app-work-order-list [isSubWorkOrder]="isSubWorkOrder" [workOrderId]="mainWorkOrderId"   [isWorkOrderMainView]="isWorkOrderMainView" (closeView)="closeWorkOrderMainView($event)"></app-work-order-list>
                    </div>

                    <div [ngClass]="{hidedata :  subTabWorkFlow !== 'createworkFlow' }">
                        <!-- <wf-create [isWorkOrder]="isWorkOrder" [savedWorkOrderData]="savedWorkOrderData" (savedWorkFlowWorkOrderData)="savedWorkFlowData($event)" > </wf-create> -->
                    </div>
                    <div *ngIf="workFlowId && subTabWorkFlow && editWorkFlowData" [ngClass]="{hidedata: subTabWorkFlow !== 'editworkFlow' }">
                        <wf-create [isWorkOrder]="isWorkOrder" [workOrderPartNumberId]="workOrderPartNumberId" [workFlowWorkOrderId]="workFlowWorkOrderId" [savedWorkOrderData]="savedWorkOrderData" (savedWorkFlowWorkOrderData)="savedWorkFlowData($event)" > </wf-create>
                        <!-- <app-workflow-list></app-workflow-list> -->
                    </div>

                    <div *ngIf="workFlowId && subTabWorkFlow " class="wf-label-cstm" [ngClass]="{hidedata :  subTabWorkFlow !== 'viewworkFlow' }" >
                      <app-workflow-list [isWorkOrder]="isWorkOrder"  [workFlowType]="subTabWorkFlow" [workFlowId]="workFlowId" ></app-workflow-list>
                    </div>


                    <div *ngIf="labor" [ngClass]="{hidedata : gridActiveTab !== 'labor'}">
                         <app-work-order-labor [taskList]="taskList" [laborForm]="labor" [workOrderLaborList]="workOrderLaborList" [workOrderWorkFlowOriginalData]="workOrderWorkFlowOriginalData" [savedWorkOrderData]="savedWorkOrderData"
                        (saveworkOrderLabor)="saveworkOrderLabor($event)"
                        ></app-work-order-labor>
                    </div>


                    <div [ngClass]="{hidedata : gridActiveTab !== 'equipment'}">
                        <app-work-order-assets (saveEquipmentListForWO)="saveWorkOrderEquipmentList($event)"
                         (updateEquipmentListForWO)="updateWorkOrderEquipmentList($event)"
                         (refreshData)="getEquipmentByWorkOrderId($event)" 
                         [employeesOriginalData]="employeesOriginalData" 
                          [isWorkOrder]="isWorkOrder" 
                          [workFlowObject]="workFlowObject"
                          [workOrderAssetList]="workOrderAssetList" [savedWorkOrderData]="savedWorkOrderData" ></app-work-order-assets>
                    </div>

                    <div  *ngIf="workOrderId && (gridActiveTab === 'subWO') " [ngClass]="{hidedata : gridActiveTab !== 'subWO'}">
                        <app-sub-work-orderlist [workOrderId]="workOrderId"  [mpnId]="workOrderPartNumberId" ></app-sub-work-orderlist>
                     
                    </div>

                    <div  *ngIf="quote" [ngClass]="{hidedata : gridActiveTab !== 'quote' }" >
                            <app-work-order-quote [quoteForm]="quote"></app-work-order-quote>
                        </div>

                  
                      
                      <div  *ngIf="workOrderId && workOrderPartNumberId"  [ngClass]="{hidedataMain :  subTabMainComponent !== 'existingRO'} "  >
                        <app-workorder-ro-list  [mpnId]="workOrderPartNumberId" ></app-workorder-ro-list>
                      </div>
                     <div *ngIf="workOrderId && workOrderPartNumberId" [ngClass]="{hidedataMain :  subTabMainComponent !== 'createNewRO'} " >
                        <app-workorder-ro-create  [mpnId]="workOrderPartNumberId"> </app-workorder-ro-create>
                     </div>


                    <div *ngIf="workOrderId" [ngClass]="{hidedata : gridActiveTab !== 'materialList' }" >  
                      <app-work-order-complete-material-list [materialStatus]="materialStatus"
                       [isWorkOrder]="isWorkOrder" 
                       [workFlowObject]="workFlowObject" 
                       [savedWorkOrderData]="savedWorkOrderData" 
                       [mpnId]="workOrderPartNumberId"
                       [employeesOriginalData]="employeesOriginalData"
                       [workOrderMaterialList]="workOrderMaterialList"
                      (saveRIParts)="saveReservedPartorIssue($event)"
                      (saveMaterialListForWO)="saveWorkOrderMaterialList($event)"
                      (updateMaterialListForWO)="updateWorkOrderMaterialList($event)"
                      (refreshData)="getMaterialListByWorkOrderId()"
                      ></app-work-order-complete-material-list>
                    </div>
                      

                    <div *ngIf="billing && quoteMaterialList " [ngClass]="{hidedata : gridActiveTab !== 'billorInvoice'}">
                        <app-work-order-billing   
                         [billingorInvoiceForm]="billing" 
                         [legalEntityList]="legalEntityList"
                         [currencyList]="currencyList"
                         [savedWorkOrderData]="savedWorkOrderData"    
                         [employeesOriginalData]="employeesOriginalData"
                         [isEditBilling]="isEditBilling"
                         (saveWOBilling)="saveWorkOrderBilling($event)"
                         (updateWOBilling)="saveWorkOrderBilling($event)"
                        [workOrderQuoteId]="workOrderQuoteId"
                         [quoteExclusionList]="quoteExclusionList"
                          [quoteMaterialList]="quoteMaterialList"
                          [quoteFreightsList]="quoteFreightsList"
                          [quoteChargesList]="quoteChargesList"
                          [quoteLaborList]="quoteLaborList"
                         ></app-work-order-billing>
                    </div>
                    <div *ngIf="addresses" [ngClass]="{hidedata : gridActiveTab !== 'address'}">
                        <app-work-order-addresses [addressesForm]="addresses"></app-work-order-addresses>
                    </div>

                    <div [ngClass]="{hidedata: gridActiveTab !== 'analysis'}">
                        <app-work-order-analysis></app-work-order-analysis>
                    </div> 
                    <div *ngIf="documents" [ngClass]="{hidedata: gridActiveTab !== 'documents'}">
                            <app-work-order-documents [documentForm]="documents"></app-work-order-documents>
                    </div>


                    <div *ngIf="workOrderId" class="wf-label-cstm" [ngClass]="{hidedataOthers :  subTabOtherOptions !== 'charges'} ">
                      <app-work-order-charges [workFlowObject]="workFlowObject" 
                          [isWorkOrder]="isWorkOrder"
                           [workOrderChargesList]="workOrderChargesList" 
                        (saveChargesListForWO)="saveWorkOrderChargesList($event)"
                        (updateChargesListForWO)="updateWorkOrderChargesList($event)"
                        (refreshData)="getChargesListByWorkOrderId()" 
                        
                        ></app-work-order-charges> 
                    </div>


                    <div *ngIf="workOrderId" class="wf-label-cstm" [ngClass]="{hidedataOthers :  subTabOtherOptions !== 'exclusions'} ">
                      <app-work-order-exclusions [workFlowObject]="workFlowObject" 
                          [isWorkOrder]="isWorkOrder"
                           [workOrderExclusionsList]="workOrderExclusionsList" 
                        (saveExclusionsListForWO)="saveWorkOrderExclusionsList($event)"
                        (updateExclusionsListForWO)="updateWorkOrderExclusionsList($event)"
                        (refreshData)="getExclusionListByWorkOrderId()"
                        
                        ></app-work-order-exclusions> 
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>













