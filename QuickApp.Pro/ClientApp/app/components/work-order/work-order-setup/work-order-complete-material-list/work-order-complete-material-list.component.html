<!-- <div  >

   
</div> -->


<div>
    <button data-target="#addNewMaterials" data-toggle="modal" class="btn btn-primary btn-primary"
        (click)="createNew(); " style="padding: 6px 12px !important;">Add PN</button>



    <button *ngIf="workOrderMaterialList.length > 0" class="btn btn-primary btn-primary"
        style="padding: 6px 12px !important;" (click)="partsIssueRI(1)" data-toggle="modal"
        data-target="#reserve">Reserve </button>
    <button *ngIf="workOrderMaterialList.length > 0" class="btn btn-primary btn-primary"
        style="padding: 6px 12px !important" (click)="partsIssueRI(2)" data-toggle="modal" data-target="#reserve"> Issue
    </button>
    <button *ngIf="workOrderMaterialList.length > 0" class="btn btn-primary btn-primary"
        style="padding: 6px 12px !important" (click)="partsIssueRI(3)" data-toggle="modal" data-target="#reserve">
        Reserve & Issue </button>
    <button *ngIf="workOrderMaterialList.length > 0" class="btn btn-primary btn-primary"
        style="padding: 6px 12px !important" (click)="partsIssueRI(4)" data-toggle="modal" data-target="#reserve">
        UnIssue </button>
    <button *ngIf="workOrderMaterialList.length > 0" class="btn btn-primary btn-primary"
        style="padding: 6px 12px !important" (click)="partsIssueRI(5)" data-toggle="modal" data-target="#reserve">
        UnReserve </button>



</div>



<div id="addNewMaterials" class="modal fade" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">{{ isEdit ? 'Edit' : 'Add'  }} Material</h4>
            </div>
            <div class="modal-body">
                <grd-material *ngIf="!isEdit" [isWorkOrder]="isWorkOrder" [workFlow]="workFlowObject"
                    [taskList]="taskList" (saveMaterialListForWO)="saveMaterialList($event)"></grd-material>

                <grd-material *ngIf="isEdit && editData" [isEdit]="isEdit" [editData]="editData"
                    [isWorkOrder]="isWorkOrder" [workFlow]="workFlowObject" [taskList]="taskList"
                    (updateMaterialListForWO)="updateMaterialList($event)">
                </grd-material>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div>
    <p-table class="rpo-table-cstm rro-table-cstm pub-ptable-cstm" [columns]="cols" [value]="workOrderMaterialList"
        [paginator]="true" [rows]="pageSize" (onPage)="pageIndexChange($event)">
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th>Task</th>
                <th> Line Num</th>
                <th *ngFor="let col of columns">
                    {{col.header}}
                </th>
                <th>Actions </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-i="rowIndex" let-columns="columns">
            <tr>
                <td>
                    <select class="form-control select-read-only" [(ngModel)]="rowData.taskId" [disabled]="isView"
                        disabled>
                        <option value="">Select</option>
                        <option *ngFor="let task of taskList" [value]="task.taskId">{{task.description}}</option>
                    </select>
                </td>

                <td>
                    {{ (pageIndex - 1) * pageSize + i + 1 }}
                </td>

                <td *ngFor="let col of columns">
                    {{rowData[col.field]}}
                </td>
                <td class="btn-spaces">
                    <button class="btn-edit ptable-wo-btns" mat-icon-button data-target="#addNewMaterials"
                        data-toggle="modal" (click)="edit(rowData)" matTooltip="Edit">
                        <mat-icon>edit</mat-icon>
                    </button>


                    <button class="btn-edit ptable-wo-btns" mat-icon-button (click)="createNewPoWorkOrder(rowData)"
                        matTooltip="Create PO">
                        <mat-icon>add</mat-icon>
                    </button>
                    <button class="btn-delete ptable-wo-btns" mat-icon-button matTooltip="Delete"
                        (click)="delete(rowData)">
                        <mat-icon color="warn">delete</mat-icon>
                    </button>
                </td>

            </tr>
        </ng-template>
    </p-table>
</div>




<div id="reserve" class="modal fade" role="dialog" data-backdrop="static">
    <div class="modal-dialog modal-lg">


        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" *ngIf="statusId === 1">Reserved Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 2">Issued Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 3">Reserve & Issue Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 4">UnIssue Parts</h4>
                <h4 class="modal-title" *ngIf="statusId === 5">UnReserve Parts</h4>
            </div>
            <div class="form-row" style="margin-left: 15px;">
                <div class="col-md-4">
                    <p-checkbox class="p-checkbox-label-womaterial" name="task" binary="false"
                        label="Include Alternate PN" (onChange)="resetAlternateParts()" [(ngModel)]="isShowAlternatePN">
                    </p-checkbox>
                </div>
                <div class="col-md-4">
                    <p-checkbox class="p-checkbox-label-womaterial" name="task" binary="false" label="Include Eq PN"
                        (onChange)="resetEqParts()" [(ngModel)]="isShowEqPN"></p-checkbox>
                </div>
            </div>
            <div class="modal-body" *ngIf="reservedList">

                <div class="table-responsive" id="workflow-attributes-block">
                    <table class="table table-bordered table-border-modal">
                        <thead>
                            <tr>
                                <th class="text-center" colspan="1"></th>
                                <th *ngIf="isShowAlternatePN  " class="text-center" colspan="1"> </th>
                                <th *ngIf=" isShowEqPN" class="text-center" colspan="1"> </th>
                                <th colspan="10" class="text-center"> Materials</th>
                                <th colspan="3" class="text-center"> StockLine</th>
                                <th class="text-center" colspan="4"></th>
                            </tr>
                            <tr>
                                <th class="text-center">
                                    Selected
                                </th>
                                <th *ngIf="isShowAlternatePN" class="text-center">
                                    Alternate Parts
                                </th>
                                <th *ngIf="isShowEqPN" class="text-center">
                                    Equivalent Parts
                                </th>
                                <th class="text-center">PN </th>

                                <th class="text-center">Part Description</th>
                                <th class="text-center"> Alternate PN For</th>

                                <th class="text-center"> Condition Type</th>
                                <th class="text-center"> OEM /PMA /DER</th>

                                <th class="text-center">Qty Requried</th>
                                <th class="text-center">Qty Reserved</th>
                                <th class="text-center"> {{ statusId !== 5 ? 'Qty to Reserve' : 'Qty to UnReserve'}}
                                </th>
                                <th class="text-center">
                                    {{ statusId !== 3 ?  'Qty  Issued' : 'Qty to Reserve and Issue'  }} </th>
                                <th class="text-center"> {{ statusId !== 4  ?  'Qty to Issue' : 'Qty to UnIssue'}}</th>

                                <th class="text-center"> Qty on Hand </th>
                                <th class="text-center"> Qty Avb </th>
                                <th class="text-center"> Qty on Order </th>

                                <th class="text-center" *ngIf="statusId === 1 || statusId === 5 ">
                                    {{statusId == 1 ? 'Reserved' : 'UnReserved'  }} Date</th>
                                <th class="text-center" *ngIf="statusId === 1 || statusId === 5">
                                    {{statusId === 1 ? 'Reserved' : 'UnReserved'}} By</th>
                                <th class="text-center" *ngIf="statusId === 2 || statusId === 3 || statusId === 4">
                                    {{statusId === 2  ? 'Issued' : statusId === 3 ? 'Reserved & Issued'  :'UnIssued'  }}
                                    By</th>
                                <th class="text-center" *ngIf="statusId === 2 || statusId === 3 || statusId === 4">
                                    {{statusId === 2  ? 'Issued'  : 
                                    statusId === 3 ? 'Reserved & Issued'  
                                    : 'UnIssued' 
                                     }}
                                    Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let x of reservedList; let i=index;">

                                <td>
                                    <input type="checkbox" name="isParentSelected{{i}}" [(ngModel)]="x.isParentSelected"
                                        (change)="selectedParts()">
                                </td>
                                <td *ngIf="isShowAlternatePN">
                                    <input type="checkbox" name="showAlternateParts{{i}}"
                                        (ngModelChange)="showAlternateParts($event , x.woReservedIssuedAltParts)"
                                        [(ngModel)]="x.showAlternateParts">
                                </td>
                                <td *ngIf="isShowEqPN">
                                    <input type="checkbox" name="showEqParts{{i}}"
                                        (ngModelChange)="showEquantParts($event , x.woReservedIssuedEquParts)"
                                        [(ngModel)]="x.showEqParts">
                                </td>


                                <td>{{x.partNumber}}</td>
                                <td>{{x.partDescription}}</td>
                                <td></td>


                                <td>{{x.condition}}</td>
                                <td>{{x.oemDer}}</td>
                                <td>
                                    {{x.quantity}}

                                </td>
                                <td>
                                    {{x.quantityAlreadyReserved}}
                                </td>
                                <td *ngIf="(statusId !== 1 && statusId !== 5)">
                                    {{x.quantityReserved}}
                                </td>
                                <td *ngIf="(statusId === 1 || statusId === 5)">
                                    <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityReserved"
                                        (keyup)="validatePartsQuantity(x)">

                                </td>

                                <td>
                                    {{x.quantityAlreadyIssued}}
                                </td>
                                <td *ngIf="(statusId !== 2 && statusId !== 3 && statusId !== 4)">
                                    {{x.quantityIssued}}
                                </td>
                                <td *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)">

                                    <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityIssued"
                                        (keyup)="validatePartsQuantity(x)" [disabled]="statusId === 1 || statusId ===5">
                                </td>

                                <td>{{x.quantityOnHand}}</td>
                                <td>{{x.quantityAvailable}}</td>
                                <td>{{x.quantityOnOrder}}</td>


                                <td *ngIf="statusId != 2 && statusId != 3 && statusId != 4">
                                    <p-calendar [showIcon]="true" class="calender-cstm" name="reservedDate"
                                        #reservedDate="ngModel" required [(ngModel)]="x.reservedDate"></p-calendar>

                                </td>
                                <td *ngIf="statusId != 2 && statusId  != 3 && statusId != 4">
                                    <p-dropdown [options]="employeesOriginalData" name="reservedBy"
                                        #reservedBy="ngModel" placeholder="Select "
                                        class="p-dropdown-custom-md-Header-table" [(ngModel)]="x.reservedById" required>
                                    </p-dropdown>

                                </td>
                                <td *ngIf="statusId != 1 && statusId != 5 ">
                                    <p-dropdown [options]="employeesOriginalData" name="issuedBy" #issuedBy="ngModel"
                                        placeholder="Select " class="p-dropdown-custom-md-Header-table"
                                        [(ngModel)]="x.issuedById" required>
                                    </p-dropdown>

                                </td>
                                <td *ngIf="statusId != 1 &&  statusId != 5 ">
                                    <p-calendar [showIcon]="true" class="calender-cstm" name="issuedDate"
                                        #issuedDate="ngModel" required [(ngModel)]="x.issuedDate"></p-calendar>

                                </td>

                            </tr>


                            <tr [hidden]="alternatePartData.length === 0">

                                <th class="text-center">

                                </th>
                                <th *ngIf="isShowAlternatePN" class="text-center">Alternate Part</th>
                                <th *ngIf="isShowEqPN" class="text-center">
                                    Equivalent Parts
                                </th>
                                <th class="text-center">PN </th>
                                <th class="text-center">Part Description</th>
                                <th class="text-center"> Alternate PN For</th>
                                <th class="text-center"> Condition Type</th>
                                <th class="text-center"> OEM /PMA /DER</th>
                                <th class="text-center">Qty Requried</th>
                                <th class="text-center">Qty Reserved</th>


                                <th class="text-center"> {{ statusId !== 5 ? 'Qty to Reserve' : 'Qty to UnReserve'}}
                                </th>
                                <th class="text-center">
                                    {{ statusId !== 3 ?  'Qty  Issued' : 'Qty to Reserve and Issue'  }} </th>
                                <th class="text-center"> {{ statusId !== 4  ?  'Qty to Issue' : 'Qty to UnIssue'}}</th>

                                <th class="text-center"> Qty on Hand </th>
                                <th class="text-center"> Qty Avb </th>
                                <th class="text-center"> Qty on Order </th>




                                <th class="text-center">Reserved Date</th>
                                <th class="text-center">Reserved By</th>
                                <th class="text-center">Issued By</th>
                                <th class="text-center">Issed Date</th>


                            </tr>

                            <tr *ngFor="let x of alternatePartData; ">


                                <td>
                                    <input type="checkbox" [(ngModel)]="x.isChildSelected" name="isChildSelected{{i}}"
                                        (change)="selectedParts()">
                                </td>
                                <td *ngIf="isShowAlternatePN">

                                </td>
                                <td *ngIf="isShowEqPN">

                                </td>
                                <td>{{x.altPartNumber}}</td>
                                <td>{{x.altPartDescription}}</td>
                                <td>{{x.parentPartNo}}</td>


                                <td>{{x.condition}}</td>
                                <td>{{x.oemDer}}</td>
                                <td>
                                    {{x.quantity}}
                                </td>
                                <td>{{x.quantityAlreadyReserved}}</td>
                                <td *ngIf="(statusId !== 1 && statusId !== 5)">
                                    {{x.quantityReserved}}
                                </td>
                                <td *ngIf="(statusId === 1 || statusId === 5)">
                                    <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityReserved"
                                        (keyup)="validatePartsQuantity(x)">

                                </td>

                                <td>{{x.quantityAlreadyReserved}}</td>

                                <td *ngIf="(statusId !== 2 && statusId !== 3 && statusId !== 4)">
                                    {{x.quantityIssued}}
                                </td>
                                <td *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)">

                                    <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityIssued"
                                        (keyup)="validatePartsQuantity(x)" [disabled]="statusId === 1 || statusId ===5">
                                </td>

                                <td>
                                    {{x.quantityOnHand}}
                                    <!-- <input type="number" name="alterHand{{i}}" [(ngModel)]="x.quantityOnHand"> -->
                                </td>
                                <td>
                                    {{x.quantityAvailable}}
                                    <!-- <input type="number" name="alterAvailable{{i}}" [(ngModel)]="x.quantityAvailable"> -->
                                </td>
                                <td>
                                    {{x.quantityOnOrder}}
                                    <!-- <input type="number" name="alterOrder{{i}}" [(ngModel)]="x.quantityOnOrder"> -->
                                </td>
                                <td>
                                    <p-calendar [showIcon]="true" class="calender-cstm" name="reservedDate"
                                        #reservedDate="ngModel" required [(ngModel)]="x.reservedDate"></p-calendar>
                                </td>
                                <td>
                                    <p-dropdown [options]="employeesOriginalData" name="reservedBy"
                                        #reservedBy="ngModel" placeholder="Select "
                                        class="p-dropdown-custom-md-Header-table" [(ngModel)]="x.reservedById" required>
                                    </p-dropdown>
                                </td>
                                <td>
                                    <p-dropdown [options]="employeesOriginalData" name="issuedBy" #issuedBy="ngModel"
                                        placeholder="Select " class="p-dropdown-custom-md-Header-table"
                                        [(ngModel)]="x.issuedById" required>
                                    </p-dropdown>
                                </td>
                                <td>
                                    <p-calendar [showIcon]="true" class="calender-cstm" name="issuedDate"
                                        #issuedDate="ngModel" required [(ngModel)]="x.issuedDate"></p-calendar>
                                </td>
                            </tr>

                            <tr [hidden]="eqPartData.length === 0">

                                <th class="text-center">

                                </th>
                                <th *ngIf="isShowAlternatePN" class="text-center">Alternate Part</th>
                                <th *ngIf="isShowEqPN" class="text-center">
                                    Equivalent Parts
                                </th>
                                <th class="text-center">PN </th>
                                <th class="text-center">Part Description</th>
                                <th class="text-center"> Equivalent PN For</th>
                                <th class="text-center"> Condition Type</th>
                                <th class="text-center"> OEM /PMA /DER</th>
                                <th class="text-center">Qty Requried</th>
                                <th class="text-center">Qty Reserved</th>


                                <th class="text-center"> {{ statusId !== 5 ? 'Qty to Reserve' : 'Qty to UnReserve'}}
                                </th>
                                <th class="text-center">
                                    {{ statusId !== 3 ?  'Qty  Issued' : 'Qty to Reserve and Issue'  }} </th>
                                <th class="text-center"> {{ statusId !== 4  ?  'Qty to Issue' : 'Qty to UnIssue'}}</th>

                                <th class="text-center"> Qty on Hand </th>
                                <th class="text-center"> Qty Avb </th>
                                <th class="text-center"> Qty on Order </th>




                                <th class="text-center">Reserved By</th>
                                <th class="text-center">Reserved Date</th>
                                <th class="text-center">Issued By</th>
                                <th class="text-center">Issed Date</th>


                            </tr>

                            <tr *ngFor="let x of eqPartData; ">


                                <td>
                                    <input type="checkbox" [(ngModel)]="x.isChildSelected" name="isChildSelected{{i}}"
                                        (change)="selectedParts()">
                                </td>
                                <td *ngIf="isShowAlternatePN">

                                </td>
                                <td *ngIf="isShowEqPN">

                                </td>
                                <td>{{x.equPartNumber}}</td>
                                <td>{{x.equPartDescription}}</td>
                                <td>{{x.parentPartNo}}</td>


                                <td>{{x.condition}}</td>
                                <td>{{x.oemDer}}</td>
                                <td>
                                    {{x.quantity}}
                                </td>
                                <td>{{x.quantityAlreadyReserved}}</td>
                                <td *ngIf="(statusId !== 1 && statusId !== 5)">
                                    {{x.quantityReserved}}
                                </td>
                                <td *ngIf="(statusId === 1 || statusId === 5)">
                                    <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityReserved"
                                        (keyup)="validatePartsQuantity(x)">

                                </td>

                                <td>{{x.quantityAlreadyReserved}}</td>

                                <td *ngIf="(statusId !== 2 && statusId !== 3 && statusId !== 4)">
                                    {{x.quantityIssued}}
                                </td>
                                <td *ngIf="(statusId === 2 || statusId === 3 || statusId === 4)">

                                    <input type="number" name="quantity{{i}}" [(ngModel)]="x.quantityIssued"
                                        (keyup)="validatePartsQuantity(x)" [disabled]="statusId === 1 || statusId ===5">
                                </td>

                                <td>
                                    {{x.quantityOnHand}}
                                    <!-- <input type="number" name="alterHand{{i}}" [(ngModel)]="x.quantityOnHand"> -->
                                </td>
                                <td>
                                    {{x.quantityAvailable}}
                                    <!-- <input type="number" name="alterAvailable{{i}}" [(ngModel)]="x.quantityAvailable"> -->
                                </td>
                                <td>
                                    {{x.quantityOnOrder}}
                                    <!-- <input type="number" name="alterOrder{{i}}" [(ngModel)]="x.quantityOnOrder"> -->
                                </td>
                                <td>
                                    <p-calendar [showIcon]="true" class="calender-cstm" name="reservedDate"
                                        #reservedDate="ngModel" required [(ngModel)]="x.reservedDate"></p-calendar>
                                </td>
                                <td>
                                    <p-dropdown [options]="employeesOriginalData" name="reservedBy"
                                        #reservedBy="ngModel" placeholder="Select "
                                        class="p-dropdown-custom-md-Header-table" [(ngModel)]="x.reservedById" required>
                                    </p-dropdown>
                                </td>
                                <td>
                                    <p-dropdown [options]="employeesOriginalData" name="issuedBy" #issuedBy="ngModel"
                                        placeholder="Select " class="p-dropdown-custom-md-Header-table"
                                        [(ngModel)]="x.issuedById" required>
                                    </p-dropdown>
                                </td>
                                <td>
                                    <p-calendar [showIcon]="true" class="calender-cstm" name="issuedDate"
                                        #issuedDate="ngModel" required [(ngModel)]="x.issuedDate"></p-calendar>
                                </td>
                            </tr>






                        </tbody>
                    </table>
                    <div style="float:right">

                    </div>


                </div>
            </div>


            <div class="modal-footer">
                <button class="btn btn-primary btn-primary" data-dismiss="modal" (click)="saveRIPart()"
                    [disabled]="!(checkedParts.length>0)" style="padding: 6px 12px !important;">Save </button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>