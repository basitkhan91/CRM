

<div [@fadeInOut] class="page-content">
    <div class="right_col" role="main">

        <div class="x_content">
            <div class="card">
                <div class="card-body">
                    <div *ngIf="!isViewMode">
                        <div class="inline-block display-flex" *ngIf="!isEnableVendor">
                            <h4 class="po-head" style="padding-right: 8px;"> Vendor Caps List </h4>
                            <a matTooltip="Add Vendor Capabilities" (click)="navigateTogeneralInfo()" class="plusicon-cstm ">
                                <i class="fa fa-plus-circle fa-lg"></i>
                            </a>
                        </div>
                    </div>

                    <div class="form-row status-radio" style="margin: 0px 4px;" *ngIf="!isViewMode">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label style="float:left; width:auto; margin-right:20px; padding-top:3px;">Status:</label>
                                <div class="pull-left" style="margin-top: 4px; margin-right: 15px;">
                                    <label class="radio-cstm wauto">
                                        <input type="radio" name="capesStatus" class="form-control" value="active" (click)="getVenCapesListByStatus('active')" checked>
                                        <span class="checkmark"></span>Active</label>
                                </div>
                                <div class="pull-left" style="margin-top: 4px; margin-right: 15px;">
                                    <label class="radio-cstm wauto">
                                        <input type="radio" name="capesStatus" class="form-control" value="inactive" (click)="getVenCapesListByStatus('inactive')">
                                        <span class="checkmark"></span>InActive</label>
                                </div>
                                <div class="pull-left" style="margin-top: 4px; margin-right: 15px;">
                                    <label class="radio-cstm wauto">
                                        <input type="radio" name="capesStatus" class="form-control" value="all" (click)="getVenCapesListByStatus('all')">
                                        <span class="checkmark"></span>All</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p-table #dt class="rpo-table-cstm lastcol-fix" [value]="allvendorCapsList" [rows]="10" [metaKeySelection]="true" [paginator]="true" [pageLinks]="3" [rowsPerPageOptions]="[10,20,50,100]" [columns]="selectedColumns" selectionMode="multiple" [(selection)]="selectedColumn" [resizableColumns]="true" [reorderableColumns]="true" [scrollable]="true" scrollHeight="450px" [loading]="loaderForVendorCapesList">
                            <ng-template pTemplate="caption" *ngIf="!isViewMode">
        
                                <div style="text-align: right">
                                    <p-multiSelect [options]="cols" [(ngModel)]="selectedColumns" optionLabel="header"
                                                   selectedItemsLabel="{0} columns selected" [style]="{minWidth: '200px'}" defaultLabel="Choose Columns" style="float:left"></p-multiSelect>
                                    <div class="inner-addon right-addon w200 inline-block g-filter-search-cstm">
                                        <i class="fa fa-search"></i>
                                        <input type="text" pInputText size="50" class="form-control ui-autocomplete-input" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder=" Filter">
                                    </div>
                                    <button type="button" class="btn-primary" pButton icon="fa-download" iconPos="left" label="Export  Data" (click)="dt.exportCSV()" matTooltip="Download Data" matTooltipPosition="above" style="padding: 5px 12px !important;"></button>
                                    <button type="button" class="btn-primary" pButton icon="fa-download" iconPos="left" label="Export Selected Data" matTooltip="Download Selected Data" matTooltipPosition="above" (click)="dt.exportCSV({selectionOnly:true})" style="padding: 5px 12px !important;"></button>
                                </div>
        
                                <div class="clear"></div>
                            </ng-template>
        
                            <ng-template pTemplate="colgroup" let-columns>
                                <colgroup>
                                    <col *ngFor="let col of columns" style="width:130px">
                                </colgroup>
                            </ng-template>
        
  
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <th *ngFor="let col of columns" pResizableColumn pReorderableColumn [pSortableColumn]="col.field">
                                        {{col.header}}
                                        <p-sortIcon [field]="col.field"></p-sortIcon>
                                    </th>
                                    <th style="width:200px;position:sticky"
                                        *ngIf="selectedColumns.length > 0">
                                        Actions
                                    </th>
                                </tr>
                                <tr>
                                    <th *ngFor="let col of columns" [ngSwitch]="col.field">
                                        <input style="width:100%;" pInputText type="text" (input)="dt.filter($event.target.value, col.field, 'contains')">
        
                                    </th>
                                    <th style="width:200px;position:sticky"></th>
                                </tr>
                            </ng-template>
        
                            <ng-template pTemplate="body" let-rowData let-columns="columns">
                                <tr [pSelectableRow]="rowData" [pSelectableRowDblClick]="rowData" pReorderableRowHandle (dblclick)="viewSelectedRowdbl(rowData)">
        
                                    <td *ngFor="let col of columns" class="ui-resizable-column" pReorderableRowHandle>
                                        {{col.field == 'createdDate'?  (rowData[col.field] | date: 'MM/dd/yyyy h:mm:ss a'):rowData[col.field] && col.field == 'updatedDate'?  (rowData[col.field] | date: 'MM/dd/yyyy h:mm:ss a'):rowData[col.field]}}
                                    </td>
        
                                    <td class="text-center" style="width:200px">
                                        <ng-container *ngIf="!isViewMode">
                                            <p-inputSwitch *ngIf="rowData['isActive']==true" matTooltip="Active" onLabel="on" offLabel="off" (onChange)="handleChange(rowData,$event)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                                            <p-inputSwitch *ngIf="rowData['isActive']==false" matTooltip="In Active" onLabel="on" offLabel="off" (onChange)="handleChange(rowData,$event)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                                            <p-inputSwitch *ngIf="rowData['isActive']==null" matTooltip="In Active" onLabel="on" offLabel="off" (onChange)="handleChange(rowData,$event)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                                        </ng-container>
                                                
                                        <span data-toggle="modal" data-target="#vendorCapesView"><a class="btn nobg" (click)="viewSelectedRow(rowData)" matTooltip="View"><i class="fa fa-eye"></i></a> </span>
                                        <span *ngIf="!isViewMode"><a class="btn nobg" (click)="openEdits(rowData)" matTooltip="Edit"><i class="fa fa-pencil"></i></a> </span>
                                        <span><a class="btn nobg" (click)="openHistory(contentAuditHist,rowData)" matTooltip="History"><i class="fa fa-history"></i></a></span>
                                        <span *ngIf="!isViewMode"><a class="btn nobg" (click)="openDelete(content,rowData)" matTooltip="Delete"><i class="fa fa-trash"></i></a> </span>
                                        <span *ngIf="!isViewMode"><a class="btn nobg btn-pluspo-cstm" (click)="gotoCreatePO(rowData)" matTooltip="Create PO"><i class="fa fa-plus"></i></a> </span>
                                        <span *ngIf="!isViewMode"><a class="btn nobg btn-plusro-cstm" (click)="gotoCreateRO(rowData)" matTooltip="Create RO"><i class="fa fa-plus" style="color: #259e08;"></i></a> </span>

                                        <!-- <span>
                                        <a class="btn btn-info boxed-float-btn nobg" data-toggle="tooltip" (click)="viewSelectedRow(rowData)" data-target="#vendorCapesView" data-toggle="modal" matTooltip="View" >
                                            <i class="fa fa-eye"></i>
                                        </a>
                                        </span> -->
                                        <!-- <button class="btn-edit" mat-icon-button (click)="openEdits(rowData)" matTooltip="edit">
                                            <mat-icon>edit</mat-icon>
                                        </button> -->
                                        <!-- <button class="btn-history" mat-icon-button matTooltip="History" (click)="openHistory(contentAuditHist,rowData)">
                                            <mat-icon color="green">history</mat-icon>
                                        </button> -->
                                        <!-- <button class="btn-delete" mat-icon-button matTooltip="Delete" (click)="openDelete(content,rowData)">
                                            <mat-icon color="warn">delete</mat-icon>
                                        </button> -->
                                        <!-- <span data-toggle="modal" data-target="#contacts"> <a class="btn btn-primary boxed-float-btn nobg" data-toggle="tooltip" (click)="gotoCreatePO(rowData)" matTooltip="Create PO"><i class="fa fa-plus"></i></a> </span>
                                        <span data-toggle="modal" data-target="#contacts"> <a class="btn btn-primary boxed-float-btn nobg"  data-toggle="tooltip" (click)="gotoCreateRO(rowData)" matTooltip="Create RO"><i class="fa fa-plus" style="color:forestgreen"></i></a></span> -->
                                    </td>
        
                                </tr>
                            </ng-template>
                            <!-- <ng-template pTemplate="summary" id="footer">
                                <div style="text-align: right;">
                                    <label id="footer" class="footer">No'of records:</label>
                                    <input style="width: 5%;"
                                            [(ngModel)]="totalRecords"
                                            [disabled]="true"
                                            pInputText
                                            type="text" />
                                    &nbsp;&nbsp;
                                    <label id="footer" class="footer1">Pages Count:</label>
                                    <input style="width: 5%;"
                                            [(ngModel)]="totalPages"
                                            [disabled]="true"
                                            pInputText
                                            type="text" />
                                </div>                    
                                </ng-template> -->

                                <ng-template pTemplate="emptymessage" let-columns *ngIf="allvendorCapsList?.length == 0">
                                    <tr>
                                       
                                        <td  [attr.colspan]="8" style="color: red; font-weight: bold; text-align: center">
                                            No records found
                                        </td>
                                    </tr>
                                </ng-template>
                                <ng-template pTemplate="summary" id="footer">
                                    <label id="footer" class="footer">No'of records:</label>
                                    <input style="width: 5%;" [(ngModel)]="dt._totalRecords" [disabled]="true" pInputText type="text" /> &nbsp;&nbsp;
                                    <label id="footer" class="footer1">Pages Count:</label>
                                   
                                    <input style="width: 5%;" [ngModel]="getPageCount(dt._totalRecords,pageSize)" [disabled]="true" pInputText type="text" />
                                </ng-template>

                    </p-table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Contact Modal -->
<ng-template #content let-c="close" let-d="dismiss" data-backdrop="static">
    <div class="modal-header">
        <h4 class="modal-title">Are You Sure Want to Delete ?</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <strong>Vendor Name:
            <span class="new-label">{{sourceAction.vendorName}}</span>
        </strong>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="deleteItemAndCloseModel()">Yes</button>
        <button type="button" class="btn btn-danger" (click)="dismissModel()">No</button>
    </div>
</ng-template>

<ng-template #contentAuditHist let-c="close" let-d="dismiss" style="width:auto" data-backdrop="static">
    <div class="modal-header" *ngIf="capabilityauditHisory.length > 0">
        <h4 class="modal-title">History of Vendor Capability: <span>"{{vendorNameHist}}"</span></h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
            <div class="table-responsive rro-table-cstm">
                    <table class="table table-bordered" *ngIf="capabilityauditHisory.length> 0 else noDatavailable" >
                        <thead>
                            <tr>
                                <th>Vendor Code</th>
                                <th>Vendor Name</th>
                                <th>Vendor Caps</th>
                                <th>PN</th>
                                <th>PN Description</th>
                                <th>Caps Type</th>
                                <th>Vendor Ranking</th>
                                <th>TAT</th>
                                <th>Is Active</th>
                                <th>Updated By</th>
                                <th>Updated Time</th>
                            </tr>
                        </thead>
                        <tbody *ngIf="capabilityauditHisory.length> 0" >
                                <tr *ngFor="let audit of capabilityauditHisory; let i = index;">
                                    <!-- auditHistory[i>0 ? i-1 : i] -->          
                                        <td [ngStyle]="{'color':  getColorCodeForHistory(i, 'vendorCode', audit.vendorCode)  ? 'black' : 'red'  }">{{audit.vendorCode}}</td>
                                        <td [ngStyle]="{'color':  getColorCodeForHistory(i, 'vendorName', audit.vendorName)  ? 'black' : 'red'  }">{{audit.vendorName}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'capabilityDescription', audit.capabilityDescription)  ? 'black' : 'red'  }">{{audit.capabilityDescription}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'partNumber', audit.partNumber)  ? 'black' : 'red'  }">{{audit.partNumber}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'partDescription', audit.partDescription)  ? 'black' : 'red'  }">{{audit.partDescription}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'capabilityType', audit.capabilityType)  ? 'black' : 'red'  }">{{audit.capabilityType}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'vendorRanking', audit.vendorRanking)  ? 'black' : 'red'  }">{{audit.vendorRanking}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'tat', audit.tat)  ? 'black' : 'red'  }">{{audit.tat}}</td>
                                         <td [ngStyle]="{'color': getColorCodeForHistory(i, 'isActive', audit.isActive)  ? 'black' : 'red'  }">{{audit.isActive}}</td>
                                        <td >{{audit.updatedBy}}</td>
                                        <td>{{audit.updatedDate | date: 'dd-MM-yyyy'}}</td>
                                    </tr>
                        </tbody>                        
                    </table>
                    <ng-template #noDatavailable>
                        <div class="text-center"> 
                                <img src="../../../../assets/images/binoculars.png" style="height: 100px; width: 100px;">
                                <h4 style="color: #ff5663;">No History Found </h4>
                        </div>

                    </ng-template>  
                </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="dismissModel()">Close</button>
    </div>
</ng-template>

<div class="modal fade" id="vendorCapesView" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">

            <div class="modal-header" >
              <button type="button" class="close" data-dismiss="modal">&times;</button> <!--data-dismiss="modal"-->
              <h4 class="modal-title">Capability Details of Vendor: <span>"{{vendorCapesGeneralInfo.vendorName}}"</span></h4>
            </div>
            <div class="modal-body" *ngIf="vendorCapesGeneralInfo">
              <div>
                <div class="card">
                    <div class="card-body" >
                        <h4 class="po-head">General Information:</h4>
                        <div class="table-responsive default-bg clear vendorCapes-generalInfo">
                            <div class="col-sm-3">
                                <p><span class="label"><b>Vendor Name: </b></span><span class="value">{{vendorCapesGeneralInfo.vendorName ? vendorCapesGeneralInfo.vendorName : '-'}}</span></p>
                                <p><span class="label"><b>Vendor Code: </b></span><span class="value">{{vendorCapesGeneralInfo.vendorCode ? vendorCapesGeneralInfo.vendorCode : '-'}}</span></p>
                                <p><span class="label"><b>PN:<span class="clr-red">*</span>  </b></span><span class="value">{{vendorCapesGeneralInfo.partNumber ? vendorCapesGeneralInfo.partNumber : '-'}}</span></p>
                                <p><span class="label"><b>PN Description: </b></span><span class="value">{{vendorCapesGeneralInfo.partDescription ? vendorCapesGeneralInfo.partDescription : '-'}}</span></p>
                            </div>
                            <div class="col-sm-3">
                                <p><span class="label"><b>PN Mfg: </b></span><span class="value">{{vendorCapesGeneralInfo.manufacturerName ? vendorCapesGeneralInfo.manufacturerName : '-'}}</span></p>
                                <p><span class="label"><b>Vendor Capability Type: <span class="clr-red">*</span> </b></span><span class="value">{{vendorCapesGeneralInfo.capabilityType ? vendorCapesGeneralInfo.capabilityType : '-'}}</span></p>
                                <p><span class="label"><b>Vendor Ranking:<span class="clr-red">*</span>  </b></span><span class="value">{{vendorCapesGeneralInfo.vendorRanking ? vendorCapesGeneralInfo.vendorRanking : '-'}}</span></p>
                            </div>
                            <div class="col-sm-3">
                                <p><span class="label"><b>PMA: </b></span><span class="value">{{vendorCapesGeneralInfo.isPMA ? vendorCapesGeneralInfo.isPMA : '-'}}</span></p>
                                <p><span class="label"><b>DER: </b></span><span class="value">{{vendorCapesGeneralInfo.isDER ? vendorCapesGeneralInfo.isDER : '-'}}</span></p>
                                <p><span class="label"><b>Cost: </b></span><span class="value">{{vendorCapesGeneralInfo.cost ? vendorCapesGeneralInfo.cost : '-'}}</span></p>
                            </div>
                            <div class="col-sm-3">
                                <p><span class="label"><b>TAT (Days): </b></span><span class="value">{{vendorCapesGeneralInfo.tat ? vendorCapesGeneralInfo.tat : '-'}}</span></p>
                                <p><span class="label"><b>Cap Description: </b></span><span class="value">{{vendorCapesGeneralInfo.capabilityDescription ? vendorCapesGeneralInfo.capabilityDescription : '-'}}</span></p>
                                <p><span class="label"><b>Memo: </b></span><span class="value">{{vendorCapesGeneralInfo.memo ? vendorCapesGeneralInfo.memo : '-'}}</span></p>
                            </div>
                        </div>
                        <h4 class="po-head">Aircraft Information:</h4>
                        <p-table class="ptable-custom" [value]="aircraftListDataValues" [rows]="6" [columns]="colsaircraftLD" [scrollable]="true" [style]="{width:'100%'}" [paginator]="true">
                            <ng-template pTemplate="header" let-columns>
                                <tr>
                                    <!-- <th>Id</th> -->
                                    <th *ngFor="let col of columns">
                                        {{col.header}}
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
                                <tr>
                                    <!-- <td>{{i+1}}</td> -->
                                    <td *ngFor="let col of columns">
                                        {{rowData[col.field]}}
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>