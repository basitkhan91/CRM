﻿<p-breadcrumb [model]="breadcrumbs" [home]="home"></p-breadcrumb>

<div class="card">
    <div class="card-body">
        <div class="inline-block display-flex">
            <h3 class="po-head lead">Customers List</h3>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <a matTooltip="Create Customer"
               class="plusicon-cstm new-margin"
               [routerLink]="[
                '/customersmodule/customerpages/app-customer-create'
              ]">
                <i class="fa fa-plus-circle fa-lg"></i>
            </a>
        </div>
        <p-table #dt
                 class="rpo-table-cstm rro-table-cstm"
                 [value]="data"
                 [first]="0"
                 [rows]="pageSize"
                 [paginator]="true"
                 [pageLinks]="3"
                 [rowsPerPageOptions]="[10, 20, 50, 100]"
                 [columns]="selectedColumns"
                 selectionMode="multiple"
                 [lazy]="true"
                 (onLazyLoad)="loadData($event)"
                 [resizableColumns]="true"
                 [reorderableColumns]="true"
                 [totalRecords]="totalRecords"
                 [scrollable]="true" scrollHeight="450px">
            <ng-template pTemplate="caption">
                <div style="text-align: right;margin-left:-6px !important; min-height: 30px;">
                    <p-multiSelect [maxSelectedLabels]="2"
                                   [options]="headers"
                                   optionLabel="header"
                                   [(ngModel)]="selectedColumns"
                                   [style]="{ minWidth: '220px' }"
                                   style="float:left"
                                   (onChange)="columnsChanges()"></p-multiSelect>

                    <div style=" left: -10px;"
                         class="inner-addon right-addon w50 inline-block  g-filter-search-cstm">
                        <i class="fa fa-search"></i>
                        <input type="text"
                               pInputText
                               size="50"
                               class="form-control ui-autocomplete-input"
                               (input)="globalSearch($event.target.value)"
                               placeholder="Filter" />
                    </div>
                    <button type="button"
                            class="btn btn-primary "
                            matTooltip="Download Data" matTooltipPosition="above"
                            pButton
                            icon="fa-download"
                            iconPos="left"
                            label="Export Data"
                            style="left:-10px; padding: 5px 10px !important;"
                            (click)="dt.exportCSV()"></button>
                    <button type="button"
                            class="btn btn-primary "
                            matTooltip="Download Selected Data" matTooltipPosition="above"
                            pButton
                            icon="fa-download"
                            iconPos="left"
                            label="Export Selected Data"
                            style="left:-10px; padding: 5px 10px !important;"
                            (click)="dt.exportCSV({ selectionOnly: true })"></button>
                    <!-- <button type="button"
                            class="btn btn-primary "
                            matTooltip="Refresh Data" matTooltipPosition="above"
                            pButton
                            icon="fa-refresh"
                            iconPos="left"
                            label="Refresh"
                            style="left:-10px; padding: 5px 10px !important;"
                            (click)="refreshList();"></button> -->
                </div>
            </ng-template>
            <ng-template pTemplate="colgroup" let-columns>
                <colgroup>
                    <col *ngFor="let col of columns" style="width:130px">
                </colgroup>
            </ng-template>

            <ng-template pTemplate="header" let-columns>
                <tr>

                    <th style="width:auto"
                        *ngFor="let col of columns"
                        pResizableColumn
                        pReorderableColumn
                        [pSortableColumn]="col.field">
                        {{ col.header }}
                        <p-sortIcon [field]="col.field"></p-sortIcon>
                    </th>
                    <th style="width:180px;position:sticky"
                        *ngIf="selectedColumns.length > 0">
                        Actions
                    </th>
                </tr>
                <tr>
                    <th style="width:auto" *ngFor="let col of columns" [ngSwitch]="col.field">
                        <input style="width:100%;" pInputText type="text" (input)="dt.filter($event.target.value, col.field, 'contains')">
                    </th>
                    <th style="width:200px;position:sticky"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
                <tr [pSelectableRowDblClick]="rowData" [pSelectableRow]="rowData" pReorderableRowHandle (dblclick)="viewSelectedRow(rowData)">
                    <td style="width:auto"
                        *ngFor="let col of columns"
                        class="ui-resizable-column"
                        pReorderableRowHandle>
                        {{
              col.field == 'createdDate'
                ? (rowData[col.field] | date: 'MM/dd/yyyy')
                : rowData[col.field] && col.field == 'updatedDate'
                ? (rowData[col.field] | date: 'MM/dd/yyyy')
                : rowData[col.field]
                        }}
                    </td>
                    <td class="action-icons-cstm" style="width:180px" *ngIf="selectedColumns.length > 0">
                        <div>
                            <p-inputSwitch *ngIf="rowData['isActive']==true" matTooltip="Active" onLabel="on" offLabel="off" (onChange)="changeStatus(rowData)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                            <p-inputSwitch *ngIf="rowData['isActive']==false" matTooltip="In Active" onLabel="on" offLabel="off" (onChange)="changeStatus(rowData)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                            <p-inputSwitch *ngIf="rowData['isActive']==null" matTooltip="In Active" onLabel="on" offLabel="off" (onChange)="changeStatus(rowData)" [(ngModel)]="rowData['isActive']"></p-inputSwitch>
                            <span><a class="btn nobg" (click)="viewSelectedRow(rowData)" matTooltip="View"><i class="fa fa-eye"></i></a> </span>
                            <span><a class="btn nobg" (click)="edit(rowData)" matTooltip="Edit"><i class="fa fa-pencil"></i></a> </span>
                            <span><a class="btn nobg" (click)="openContactList(contentcontact,rowData)" matTooltip="Contacts"><i class="fa fa-users"></i></a> </span>
                            <span><a class="btn nobg" (click)="openSitesList(sitesContent,rowData)" matTooltip="Sites"><i class="fa fa-map" style="color: red"></i></a> </span>
                            <span><a class="btn nobg" (click)="openDocumentsList(documentsContent,rowData)" matTooltip="Documents"><i class="fa fa fa-file-pdf-o"></i></a> </span>
                            <span data-toggle="modal" data-target="#delete"><a class="btn nobg" (click)="delete(content1,rowData)" matTooltip="Delete"><i class="fa fa-trash"></i></a> </span>
                            <span data-toggle="modal" data-target="#contentAuditHist"><a class="btn nobg" (click)="getAuditHistoryById(contentAuditHist,rowData)" matTooltip="History"><i class="fa fa-history"></i></a></span>
                         
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="summary" id="footer">
                <label id="footer" class="footer">No'of records:</label>
                <input style="width: 5%;"
                       [(ngModel)]="totalRecords"
                       [disabled]="true"
                       pInputText
                       type="text" />
                &nbsp;&nbsp;
                <label id="footer" class="footer1">Pages Count:</label>
                <input style="width: 5%;"
                       [(ngModel)]="totalPages"
                       [disabled]="true"
                       pInputText
                       type="text" />
            </ng-template>
        </p-table>
    </div>
</div>

<ng-template #sitesContent let-c="close" let-d="dismiss" style="width:auto" data-backdrop="static">
    <div class="modal-header">

        <h4 class="modal-title">Shipping Information</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>


    </div>
    <div class="modal-body">
        <app-customer-shipping-information [customerDataFromExternalComponents]="selectedRow"></app-customer-shipping-information>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="dismissModel()">Close</button>
    </div>
</ng-template>


<ng-template #documentsContent let-c="close" let-d="dismiss" style="width:auto" data-backdrop="static">
    <div class="modal-header">

        <h4 class="modal-title">Documents</h4>
        <button type="button" class="close" aria-label="Close" (click)="dismissModel()">
            <span aria-hidden="true">&times;</span>
        </button>


    </div>
    <div class="modal-body">
        <app-customer-documents [customerDataFromExternalComponents]="selectedRow"></app-customer-documents>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="dismissModel()">Close</button>
    </div>
</ng-template>



