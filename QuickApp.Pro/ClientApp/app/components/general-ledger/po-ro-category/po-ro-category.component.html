<div [@fadeInOut] class="page-content">
	<div class="right_col" role="main">
		<div class="x_panel">
			<div class="x_content">
				<div class="card">
					<div class="card-body">
						<div class="inline-block display-flex">
							<h3 class="po-head lead">PO-RO Category List</h3>
							&nbsp;&nbsp;
							<a class="plusicon-cstm new-margin" pTooltip="Add PO-RO Category" tooltipPosition="right" (click)="resetForm()" data-target="#add"
							   data-toggle="modal">
								<i class="fa fa-plus-circle fa-lg"></i>
							</a>
						</div>
						<p-table #dt class="rpo-table-cstm rro-table-cstm" [value]="allPOROList" [first]="0" [rows]="pageSize" [paginator]="true"
								 [pageLinks]="3" [rowsPerPageOptions]="[10,20,50,100]" [columns]="selectedColumns" selectionMode="multiple"
								 (onPage)="changePage($event)" [resizableColumns]="true" [reorderableColumns]="true" [totalRecords]="totalRecords"
								 scrollHeight="450px">
							<ng-template pTemplate="caption">
								<div style="text-align: right;margin-left:-6px !important;">
									<p-multiSelect [maxSelectedLabels]="2" [options]="headers" optionLabel="header" [(ngModel)]="selectedColumns" [style]="{minWidth: '200px'}"
												   style="float:left" (onChange)="columnsChanges()"></p-multiSelect>
									<button type="button" class="btn btn-primary-cstm " pTooltip="Download All Data" pButton icon="fa-download"
											iconPos="left" label="Export All Data" (click)="dt.exportCSV()"></button>
									<button type="button" class="btn btn-primary-cstm " pTooltip="Download Selected" pButton icon="fa-download"
											iconPos="left" label="Export Selection Only" (click)="dt.exportCSV({selectionOnly:true})"></button>
									<div class="excel-upload  excel-upload-cstm">

										<input type="file" name="upload[]" id="upload" (change)="customExcelUpload($event)" class="uploaddoc upload-file" accept=".xlsx, .xls, .csv">
										<label for="upload">
											<span matTooltip="Upload Data (Excel)">
												<i class="fa fa-upload"></i>
											</span>
										</label>
										&nbsp; &nbsp;
										<button class="btn btn-primary-cstm" matTooltip="Sample File Download" (click)="sampleExcelDownload()">Sample File Download</button>
									</div>
								</div>
							</ng-template>

							<ng-template pTemplate="header" let-columns>
								<tr>
									<th style="width:250px" *ngFor="let col of columns" pResizableColumn pReorderableColumn [pSortableColumn]="col.field">
										{{col.header}}
										<p-sortIcon [field]="col.field"></p-sortIcon>
									</th>
									<th style="width:200px;position:sticky" *ngIf="selectedColumns.length> 0"> Actions</th>


								</tr>
								<tr>
									<th style="width:250px" *ngFor="let col of columns" [ngSwitch]="col.field">
										<input style="width:100%;" pInputText type="text" (input)="dt.filter($event.target.value, col.field,'contains')">
									</th>
									<th style="width:200px;position:sticky"></th>
								</tr>
							</ng-template>
							<ng-template pTemplate="body" let-rowData let-columns="columns">
								<tr [pSelectableRow]="rowData" pReorderableRowHandle>
									<td style="width:250px" *ngFor="let col of columns" class="ui-resizable-column" pReorderableRowHandle data-toggle="modal"
										data-target="#view" (dblclick)="viewSelectedRow(rowData)">
										{{
											col.field == 'createdDate'? (rowData[col.field] | date: 'MM/dd/yyyy'):rowData[col.field] && col.field == 'updatedDate'?
											(rowData[col.field] | date: 'MM/dd/yyyy'):rowData[col.field]
										}}
									</td>
									<td style="width:200px" *ngIf="selectedColumns.length> 0">
										<p-inputSwitch [(ngModel)]="rowData['isActive']" matTooltip="Update" name="isActive{{rowIndex}}" (onChange)="changeStatus(rowData)"></p-inputSwitch>
										<button class="btn-edit" mat-icon-button (click)="edit(rowData)" data-target="#add" data-toggle="modal" matTooltip="Edit">
											<mat-icon>edit</mat-icon>
										</button>

										<button class="btn-delete" mat-icon-button matTooltip="Delete" data-target="#delete" data-toggle="modal" (click)="delete(rowData)">
											<mat-icon color="warn">delete</mat-icon>
										</button>
									</td>
								</tr>
							</ng-template>
							<ng-template #auditContent let-c="close" let-d="dismiss">
								<div *ngIf="AuditDetails != undefined && AuditDetails.length > 0">
									<app-audit [Data]="AuditDetails" [Modal]="modal"></app-audit>
								</div>
							</ng-template>
							<ng-template pTemplate="summary" id="footer">
								<label id="footer" class="footer">No'of records:</label>
								<input style="width: 5%;" [(ngModel)]="totalRecords" [disabled]="true" pInputText type="text" /> &nbsp;&nbsp;
								<label id="footer" class="footer1">Pages Count:</label>
								<input style="width: 5%;" [(ngModel)]="totalPages" [disabled]="true" pInputText type="text" />
							</ng-template>
						</p-table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div *ngIf="selectedRowforDelete" #delete id="delete" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Are You Sure Want to Delete ?</h4>
			</div>
			<div class="modal-body">
				<strong>
					Category Name:
					<span class="new-label">{{selectedRowforDelete.categoryName}}</span>
				</strong>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary-cstm" data-dismiss="modal" (click)="deleteConformation('Yes')">Yes</button>
				<button type="button" class="btn btn-danger-cstm" data-dismiss="modal" (click)="deleteConformation('No')">No</button>
			</div>
		</div>

	</div>
</div>

<div #add id="add" class="modal fade" role="dialog" data-backdrop="static" data-keyboard="false">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">{{isEdit ? 'Edit' : 'Add' }} {{addNew.categoryName}} PO-RO Category </h4>
			</div>
			<div class="modal-body">
				<form #create="ngForm">
					<div class="form-group">
						<div class="col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">
									Category Name<span class="clr-red">*</span>
								</label>
							</div>
							<div class="col-sm-5">
								<input class="form-control" type="text" [(ngModel)]="addNew.categoryName" name="categoryName">
							</div>
						</div>

						<div class="form-group col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">PO</label>
							</div>
							<div class="col-sm-5 checkbox-cstm">
								<label>
									<input type="checkbox" name="poCheck" [(ngModel)]="addNew.isPO">
									<span class="cr">
										<i class="cr-icon pi pi-check"></i>
									</span>
								</label>
							</div>
						</div>

						<div class="form-group col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">RO</label>
							</div>
							<div class="col-sm-5 checkbox-cstm">
								<label>
									<input type="checkbox" name="roCheck" [(ngModel)]="addNew.isRO">
									<span class="cr">
										<i class="cr-icon pi pi-check"></i>
									</span>
								</label>
							</div>
						</div>

						<!--<div class="col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">Last updated by</label>
							</div>
							<div class="col-sm-5">
								<label for="description" class="control-label" (ngModel)="addNew.updatedBy"></label>
							</div>
						</div>

						<div class="col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">Last updated time</label>
							</div>
							<div class="col-sm-5">
								<label for="description" class="control-label" (ngModel)="addNew.updatedDate"></label>
							</div>
						</div>

						<div class="col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">Created by</label>
							</div>
							<div class="col-sm-5">
								<label for="description" class="control-label" (ngModel)="addNew.createdBy"></label>
							</div>
						</div>

						<div class="col-sm-12">
							<div class="col-sm-5">
								<label for="description" class="control-label">Created time</label>
							</div>
							<div class="col-sm-5">
								<label for="description" class="control-label" (ngModel) = "addNew.createdDate"></label>
							</div>
						</div>-->
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary-cstm" data-dismiss="modal"  (click)="save();">
					{{isEdit ? 'Update' : 'Save' }}
				</button>
				<button type="button" class="btn btn-danger-cstm" data-dismiss="modal" (click)="resetForm()">Close</button>
			</div>
		</div>
	</div>
</div>

<ng-template #content let-c="close" let-d="dismiss">
	<div class="modal-header">
		<h4 class="modal-title">Are You Sure Want to Delete ?</h4>
		<button type="button" class="close" aria-label="Close" (click)="dismissModel()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<strong>
			Ledger Name:
			<span class="new-label">{{selectedRowforDelete.categoryName}}</span>
		</strong>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-success" (click)="deleteItemAndCloseModel()">Yes</button>
		<button type="button" class="btn btn-danger" (click)="dismissModel()">No</button>
	</div>
</ng-template>


<!--<ng-template #contentHist let-c="close" let-d="dismiss" style="width:auto">
	<div class="modal-header">
		<h4 class="modal-title">History of Action</h4>
		<button type="button" class="close" aria-label="Close" (click)="dismissModel()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<div class="table-responsive">
			<table class="table table-bordered">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Value After</th>
						<th>Value Before</th>
					</tr>
				</thead>
				<tr *ngFor="let audit of auditHisory">
					<td>{{audit.columnName}}</td>
					<td>{{audit.newValue}}</td>
					<td>{{audit.previousValue}}</td>
				</tr>
			</table>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-danger" (click)="dismissModel()">Close</button>
	</div>
</ng-template>-->


<p-dialog header="Alert" [(visible)]="display" [modal]="true" [dismissableMask]="true" maximizedLeft="140px" maximizedTop="140px"
		  [width]="350" [minWidth]="200" [responsive]="true" [minY]="1050" [baseZIndex]="1100000">
	<h5 [ngStyle]="{'color':'red'}">
		Please Enter (*) Mandatory Fields
	</h5>
	<p-footer>
		<button type="button" pButton icon="pi pi-check" (click)="display=false" label="Close"></button>
	</p-footer>

</p-dialog>
